var app=function(){"use strict";function e(){}function t(e){return e()}function s(){return Object.create(null)}function n(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(t){return t&&o(t.destroy)?t.destroy:e}function r(e,t){e.appendChild(t)}function l(e,t,s){e.insertBefore(t,s||null)}function c(e){e.parentNode&&e.parentNode.removeChild(e)}function u(e,t){for(let s=0;s<e.length;s+=1)e[s]&&e[s].d(t)}function g(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function d(){return h(" ")}function p(){return h("")}function f(e,t,s,n){return e.addEventListener(t,s,n),()=>e.removeEventListener(t,s,n)}function m(e,t,s){null==s?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function y(e){return""===e?null:+e}function b(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function v(e,t,s){for(let s=0;s<e.options.length;s+=1){const n=e.options[s];if(n.__value===t)return void(n.selected=!0)}s&&void 0===t||(e.selectedIndex=-1)}function $(e){const t=e.querySelector(":checked");return t&&t.__value}function S(e,t,s){e.classList[s?"add":"remove"](t)}let T;function L(e){T=e}function x(){if(!T)throw new Error("Function called outside component initialization");return T}function k(){const e=x();return(t,s,{cancelable:n=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:s=!1,cancelable:n=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,s,n,t),o}(t,s,{cancelable:n});return o.slice().forEach(t=>{t.call(e,i)}),!i.defaultPrevented}return!0}}const C=[],E=[];let R=[];const A=[],_=Promise.resolve();let P=!1;function F(e){R.push(e)}function O(e){A.push(e)}const D=new Set;let N=0;function q(){if(0!==N)return;const e=T;do{try{for(;N<C.length;){const e=C[N];N++,L(e),I(e.$$)}}catch(e){throw C.length=0,N=0,e}for(L(null),C.length=0,N=0;E.length;)E.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];D.has(t)||(D.add(t),t())}R.length=0}while(C.length);for(;A.length;)A.pop()();P=!1,D.clear(),L(e)}function I(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const Q=new Set;let H;function V(e,t){e&&e.i&&(Q.delete(e),e.i(t))}function M(e,t,s,n){if(e&&e.o){if(Q.has(e))return;Q.add(e),H.c.push(()=>{Q.delete(e),n&&(s&&e.d(1),n())}),e.o(t)}else n&&n()}function U(e,t,s){const n=e.$$.props[t];void 0!==n&&(e.$$.bound[n]=s,s(e.$$.ctx[n]))}function B(e){e&&e.c()}function W(e,s,i,a){const{fragment:r,after_update:l}=e.$$;r&&r.m(s,i),a||F(()=>{const s=e.$$.on_mount.map(t).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...s):n(s),e.$$.on_mount=[]}),l.forEach(F)}function j(e,t){const s=e.$$;null!==s.fragment&&(!function(e){const t=[],s=[];R.forEach(n=>-1===e.indexOf(n)?t.push(n):s.push(n)),s.forEach(e=>e()),R=t}(s.after_update),n(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function K(e,t){-1===e.$$.dirty[0]&&(C.push(e),P||(P=!0,_.then(q)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function J(t,o,i,a,r,l,u,g=[-1]){const h=T;L(t);const d=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:r,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(h?h.$$.context:[])),callbacks:s(),dirty:g,skip_bound:!1,root:o.target||h.$$.root};u&&u(d.root);let p=!1;if(d.ctx=i?i(t,o.props||{},(e,s,...n)=>{const o=n.length?n[0]:s;return d.ctx&&r(d.ctx[e],d.ctx[e]=o)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](o),p&&K(t,e)),s}):[],d.update(),p=!0,n(d.before_update),d.fragment=!!a&&a(d.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);d.fragment&&d.fragment.l(e),e.forEach(c)}else d.fragment&&d.fragment.c();o.intro&&V(t.$$.fragment),W(t,o.target,o.anchor,o.customElement),q()}L(h)}class z{$destroy(){j(this,1),this.$destroy=e}$on(t,s){if(!o(s))return e;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(s),()=>{const e=n.indexOf(s);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class G{constructor(e,t,s="basic",n="/learning/",o={}){this.sourceLanguage=e,this.targetLanguage=t,this.baseDir=n,this.level=s,this.testDatabase={},this.queue=[],this.categories={},this.currentTestIndex=0,this.storageKey=`learning_queue_${e}_${t}_${s}`,this.options={passThreshold:7,memoryLength:20,repetitivenessFactor:5,...o}}async init(){await this.loadTestData(),this.loadState()}async loadTestData(){try{const e=`${this.sourceLanguage}-${this.targetLanguage}-${this.level}.json`,t=await fetch(`${this.baseDir}${e}`);if(!t.ok)throw new Error(`Failed to load test data: ${t.status}`);this.testDatabase=await t.json()}catch(e){console.error("Error loading test data:",e),this.testDatabase={travel:[{source:"Good morning",target:"Buongiorno"},{source:"Where is the station?",target:"Dove è la stazione?"},{source:"Thank you very much",target:"Grazie mille"}],food:[{source:"I would like a coffee",target:"Vorrei un caffè"},{source:"How much does it cost?",target:"Quanto costa?"},{source:"The bill please",target:"Il conto per favore"}]}}}loadState(){const e=localStorage.getItem(this.storageKey);if(e)try{const t=JSON.parse(e);this.categories=t.categories||{},this.queue=t.queue||[],this.syncQueueWithDatabase()}catch(e){console.error("Error loading saved state:",e),this.initializeAllCategories()}else this.initializeAllCategories()}syncQueueWithDatabase(){const e=new Set;for(const[t,s]of Object.entries(this.categories))s&&this.testDatabase[t]&&this.testDatabase[t].forEach(t=>{e.add(this.createTestId(t))});this.queue=this.queue.filter(t=>{const s=this.createTestId({source:t.source,target:t.target});return e.has(s)});const t=new Set(this.queue.map(e=>this.createTestId({source:e.source,target:e.target})));for(const[e,s]of Object.entries(this.categories))s&&this.testDatabase[e]&&this.testDatabase[e].forEach(s=>{const n=this.createTestId(s);t.has(n)||this.addTestToQueue(s,e)})}initializeAllCategories(){for(const e of Object.keys(this.testDatabase))this.categories[e]=!1}createTestId(e){return`${e.source}|${e.target}`}addTestToQueue(e,t){const s={source:e.source,target:e.target,inertia:-1,category:t,recentResults:new Array(this.options.memoryLength).fill(0)},n=Math.floor(Math.random()*(this.queue.length+1));this.queue.splice(n,0,s)}addCategoryToQueue(e){this.testDatabase[e]&&this.testDatabase[e].forEach(t=>{this.addTestToQueue(t,e)})}removeCategoryFromQueue(e){if(!this.testDatabase[e])return;const t=new Set(this.testDatabase[e].map(e=>this.createTestId(e)));this.queue=this.queue.filter(e=>{const s=this.createTestId({source:e.source,target:e.target});return!t.has(s)}),this.currentTestIndex>=this.queue.length&&(this.currentTestIndex=0)}getCategories(){return Object.keys(this.testDatabase)}setCategory(e,t){t&&!this.categories[e]?(this.categories[e]=!0,this.addCategoryToQueue(e)):!t&&this.categories[e]&&(this.categories[e]=!1,this.removeCategoryFromQueue(e)),this.saveState()}getNextTest(){if(0===this.queue.length)return null;this.currentTestIndex>=this.queue.length&&(this.currentTestIndex=0);const e=this.queue[this.currentTestIndex];return{source:e.source,target:e.target,inertia:e.inertia,category:e.category,recentResults:e.recentResults||[]}}scoreCurrentTest(e){if(0===this.queue.length||this.currentTestIndex>=this.queue.length)return;const t=this.queue.splice(this.currentTestIndex,1)[0];t.recentResults||(t.recentResults=[]);const s=e>=this.options.passThreshold;if(t.recentResults.push(s?1:0),!s)for(let e=t.recentResults.length-2;e>=0;e--)if(1===t.recentResults[e]){t.recentResults[e]=0;break}const n=this.options.memoryLength;t.recentResults.length>n&&(t.recentResults=t.recentResults.slice(-n));const o=t.recentResults.reduce((e,t)=>e+t,0),i=t.recentResults.length>0?o/t.recentResults.length:0,a=2+.2*(this.options.repetitivenessFactor-1),r=Math.pow(i,a),l=Math.min(Math.floor(r*this.queue.length),this.queue.length);this.queue.splice(l,0,t),this.currentTestIndex=0,this.saveState()}updateOptions(e){this.options={...this.options,...e}}saveState(){const e={categories:this.categories,queue:this.queue};try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.error("Error saving state to localStorage:",e)}}getQueueLength(){return this.queue.length}getTopQueueItems(e=null){const t=e?Math.min(e,this.queue.length):this.queue.length;return this.queue.slice(0,t).map((e,t)=>{const s=e.recentResults?e.recentResults.reduce((e,t)=>e+t,0):0,n=e.recentResults&&e.recentResults.length>0?s/e.recentResults.length:0;return{position:t+1,source:e.source,target:e.target,inertia:e.inertia,category:e.category,recentResults:e.recentResults||[],successRate:n}})}reset(){console.log("🔄 Resetting LearningQueue to initial state"),this.queue=[],this.categories={},this.currentTestIndex=0,localStorage.removeItem(this.storageKey),this.initializeAllCategories(),console.log("✅ LearningQueue reset complete")}getQueueStats(){const e={totalItems:this.queue.length,categories:{},inertiaDistribution:{negative:0,neutral:0,positive:0}};return this.queue.forEach(t=>{e.categories[t.category]||(e.categories[t.category]=0),e.categories[t.category]++;const s=t.recentResults?t.recentResults.reduce((e,t)=>e+t,0):0,n=t.recentResults&&t.recentResults.length>0?s/t.recentResults.length:0;n<.3?e.inertiaDistribution.negative++:n>.7?e.inertiaDistribution.positive++:e.inertiaDistribution.neutral++}),e}}class Y{constructor(e,t="English",s="Italian",n={}){this.outputElement=e,this.sourceLanguage=t,this.targetLanguage=s;this.options=this.mergeOptions({apiKeyEndpoint:"?mode=get_key",feedbackThreshold:7,statusCallback:null,loggingVerbosity:5,audioPath:"audio/",enableBleep:!0,enableAudioHints:!1,audioHintDuration:.25,audioHintMinWords:3,vad:{threshold:.6,prefixPaddingMs:200,silenceDurationMs:800}},n),this.audioContext=null,this.currentAudioStream=null,this.audioProcessor=null,this.ws=null,this.isListening=!1,this.isLearningSessionActive=!1,this.currentSessionKey=null,this.keyRefreshInterval=null,this.log(3,`🎓 LanguageTutor initialized: ${t} → ${s}`),this.log(7,"📋 Options:",this.options),this.initializeSessionKeys()}log(e,...t){this.options.loggingVerbosity>=e&&console.log(...t)}logError(e,...t){this.options.loggingVerbosity>=e&&console.error(...t)}logWarn(e,...t){this.options.loggingVerbosity>=e&&console.warn(...t)}mergeOptions(e,t){const s={...e};for(const n in t)t.hasOwnProperty(n)&&("object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?s[n]=t[n]:s[n]={...e[n],...t[n]});return s}async playNotificationBleep(){if(this.options.enableBleep)try{this.log(6,"🎵 Playing notification bleep");const e=new(window.AudioContext||window.webkitAudioContext),t=.3,s=e.sampleRate,n=e.createBuffer(1,t*s,s),o=n.getChannelData(0);for(let e=0;e<n.length;e++){const t=e/s;let n,i;t<.15?(n=800,i=.1*Math.sin(Math.PI*t/.15)):(n=1e3,i=.1*Math.sin(Math.PI*(t-.15)/.15)),o[e]=i*Math.sin(2*Math.PI*n*t)}const i=e.createBufferSource();return i.buffer=n,i.connect(e.destination),new Promise(t=>{i.onended=()=>{e.close(),this.log(7,"✅ Notification bleep completed"),t()},i.start()})}catch(e){this.logWarn(4,"⚠️ Could not play notification bleep:",e.message)}else this.log(7,"🔇 Notification bleep disabled")}async initializeSessionKeys(){try{await this.refreshSessionKey(),this.startKeyRefreshTimer()}catch(e){this.logError(1,"❌ Failed to initialize session keys:",e)}}async refreshSessionKey(){try{this.log(5,"🔑 Refreshing session key...");const e=await fetch(this.options.apiKeyEndpoint);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(t.error)throw new Error(t.error);return this.currentSessionKey=t.session_token,this.log(4,"✅ Session key refreshed successfully"),this.currentSessionKey}catch(e){return this.logError(2,"❌ Error refreshing session key:",e),this.showError("Failed to refresh session key: "+e.message),null}}async getSessionKey(){return this.currentSessionKey?(this.log(7,"🔑 Using cached session key"),this.currentSessionKey):(this.log(5,"🔑 Getting initial session key..."),await this.refreshSessionKey())}startKeyRefreshTimer(){this.keyRefreshInterval=setInterval(async()=>{await this.refreshSessionKey()},5e4),this.log(6,"⏰ Started key refresh timer (every 50 seconds)")}stopKeyRefreshTimer(){this.keyRefreshInterval&&(clearInterval(this.keyRefreshInterval),this.keyRefreshInterval=null,this.log(6,"⏰ Stopped key refresh timer"))}async speakText(e,t=null){return new Promise(async(s,n)=>{try{t||(t=this.detectLanguage(e)),this.log(4,`🎙️ Playing audio for "${e}" in ${t}`);const n=t===this.sourceLanguage,o=n?"native":"learning";this.log(6,`🎯 Speed mode: ${o} (${n?"normal speed":"slow/clear"})`);const i=await this.generateAudioFilename(e),a=`${this.options.audioPath}${t}/${o}/${i}`;this.log(6,`🔊 Loading audio from: ${a}`),await this.playAudioFromUrl(a),s()}catch(e){this.logError(3,"❌ Error playing audio:",e),this.showError("Audio playback failed: "+e.message),n(e)}})}async generateAudioFilename(e){const t=this.stringToUtf8Bytes(e).slice(0,20);let s="";for(let e=0;e<t.length;e++){const n=t[e],o=String.fromCharCode(n);/[a-zA-Z0-9]/.test(o)?s+=o:s+="_"}s=s.replace(/_+$/,""),s||(s="phrase");return`${s}_${(await this.sha256(e)).substring(0,8)}.mp3`}async sha256(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(e=>e.toString(16).padStart(2,"0")).join("")}stringToUtf8Bytes(e){const t=[];for(let s=0;s<e.length;s++){let n=e.charCodeAt(s);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|n>>6&63),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|n>>12&63),t.push(128|n>>6&63),t.push(128|63&n))}return t}async playAudioFromUrl(e){return new Promise((t,s)=>{try{this.log(6,"🔊 Creating audio element for playback");const n=new Audio;n.onloadeddata=()=>{this.log(7,"✅ Audio loaded successfully")},n.onended=()=>{this.log(6,"✅ Audio playback finished"),t()},n.onerror=t=>{this.logError(3,"❌ Audio playback error:",t),s(new Error(`Failed to load audio from ${e}`))},n.oncanplaythrough=()=>{this.log(7,"▶️ Starting audio playback"),n.play().catch(e=>{this.logError(3,"❌ Audio play() failed:",e),s(e)})},n.src=e,n.load()}catch(e){this.logError(3,"❌ Error setting up audio playback:",e),s(e)}})}async playAudioHint(e,t=null,s="learning"){return new Promise(async(n,o)=>{try{t||(t=this.targetLanguage),this.log(5,`🎯 Playing audio hint for: "${e}" in ${t}`);const i=await this.generateAudioFilename(e),a=`${this.options.audioPath}${t}/${s}/${i}`;this.log(6,`🔊 Loading hint audio from: ${a}`);const r=new Audio;r.onloadedmetadata=()=>{this.log(7,`✅ Audio metadata loaded, duration: ${r.duration}s`);const e=r.duration*this.options.audioHintDuration;this.log(7,`🎯 Playing first ${e.toFixed(2)}s as hint (${100*this.options.audioHintDuration}% of ${r.duration.toFixed(2)}s)`);const t=setTimeout(()=>{r.pause(),r.currentTime=0,this.log(7,"🔇 Hint playback completed"),n()},1e3*e);r.onended=()=>{clearTimeout(t),this.log(7,"🔇 Audio hint ended naturally"),n()},r.play().catch(e=>{clearTimeout(t),this.logError(3,"❌ Audio hint play() failed:",e),o(e)})},r.onerror=e=>{this.logError(3,"❌ Audio hint error:",e),o(new Error(`Failed to load audio hint from ${a}`))},r.src=a,r.load()}catch(e){this.logError(3,"❌ Error setting up audio hint:",e),o(e)}})}shouldPlayHint(e,t){if(!t||0===t.length)return this.log(8,"🎯 No hint: no recent results"),!1;const s=e.trim().split(/\s+/).length;if(s<this.options.audioHintMinWords)return this.log(8,`🎯 No hint: phrase too short (${s} words < ${this.options.audioHintMinWords} minimum)`),!1;const n=t.filter(e=>1===e).length,o=n/t.length;this.log(8,`🎯 Hint check: ${n}/${t.length} success rate: ${o.toFixed(2)}, words: ${s}`,t);const i=n>0&&o<.5;return this.log(8,`🎯 Should play hint: ${i}`),i}async startLearningSession(){this.isLearningSessionActive?this.log(6,"🎓 Learning session already active"):(this.log(5,"🎓 Starting learning session with persistent microphone"),await this.startRecording(),this.isLearningSessionActive=!0)}stopLearningSession(){this.isLearningSessionActive?(this.log(5,"🎓 Stopping learning session and releasing microphone"),this.stopRecording(),this.isLearningSessionActive=!1):this.log(6,"🎓 No learning session to stop")}isSessionActive(){return this.isLearningSessionActive}async startRecording(){try{const e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:24e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.currentAudioStream=e,this.audioContext=new AudioContext({sampleRate:24e3});const t=this.audioContext.createMediaStreamSource(e);this.audioProcessor=this.audioContext.createScriptProcessor(1024,1,1),this.audioProcessor.onaudioprocess=e=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN&&this.isListening){const t=e.inputBuffer.getChannelData(0),s=new Int16Array(t.length);for(let e=0;e<t.length;e++)s[e]=Math.max(-32768,Math.min(32767,32768*t[e]));const n=new Uint8Array(s.buffer),o=btoa(String.fromCharCode.apply(null,n));this.ws.send(JSON.stringify({type:"input_audio_buffer.append",audio:o}))}},t.connect(this.audioProcessor),this.audioProcessor.connect(this.audioContext.destination),this.isListening=!0,this.log(5,"🎤 Started recording and listening")}catch(e){throw this.logError(2,"Error starting recording:",e),this.showError("Could not access microphone: "+e.message),e}}pauseListening(){this.isListening=!1,this.log(6,"⏸️ Paused listening (microphone still active)")}resumeListening(){this.isListening=!0,this.log(6,"▶️ Resumed listening")}stopRecording(){this.isListening=!1,this.currentAudioStream&&(this.currentAudioStream.getTracks().forEach(e=>e.stop()),this.currentAudioStream=null),this.audioProcessor&&(this.audioProcessor.disconnect(),this.audioProcessor=null),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null),this.log(5,"🛑 Stopped recording completely")}detectLanguage(e){const t=["the","a","an","is","are","was","were","and","or","but","in","on","at","to","for","of","with","by"],s=e.toLowerCase().split(/\s+/);return s.filter(e=>t.includes(e)).length/s.length>.2?this.sourceLanguage:this.targetLanguage}showStatus(e){this.log(7,"📢 Status:",e),this.options.statusCallback&&this.options.statusCallback(e),this.outputElement&&(this.outputElement.textContent=e)}showError(e){this.logError(2,"❌ Error:",e),this.outputElement&&(this.outputElement.textContent="Error: "+e,this.outputElement.style.color="red",setTimeout(()=>{this.outputElement.style.color=""},3e3))}showScore(e){return this.log(4,"📊 Score:",e),{score:e,message:this.getScoreMessage(e),emoji:this.getScoreEmoji(e)}}getScoreMessage(e){return e>=8?"Excellent work!":e>=6?"Good job!":"Keep practicing!"}getScoreEmoji(e){return e>=8?"🎉":e>=6?"👍":"📚"}updateOptions(e){return this.log(5,"🔧 Updating tutor options:",e),this.options=this.mergeOptions(this.options,e),this.log(6,"✅ Options updated:",this.options),this.options}getOptions(){return{...this.options}}clearTTSCache(){try{return localStorage.removeItem("tts_audio_cache"),this.log(4,"🗑️ Legacy TTS cache cleared successfully"),!0}catch(e){return this.logError(3,"❌ Error clearing legacy TTS cache:",e),!1}}getTTSCacheSize(){return{entries:0,chunks:0,sizeBytes:0,sizeMB:0,note:"Using server-side audio files - no client cache needed"}}async test(e,t,s=[],n=10){try{this.showStatus("Getting session key...");const o=await this.getSessionKey();return o?(this.showStatus("Connecting to ChatGPT..."),this.log(4,"🔗 Creating new ChatGPT WebSocket connection for testing"),this.log(6,"🎚️ Using VAD settings:",this.options.vad),this.log(6,"🎯 Feedback threshold:",this.options.feedbackThreshold),this.ws=new WebSocket("wss://api.openai.com/v1/realtime?model=gpt-4o-mini-realtime-preview&openai-beta=realtime%3Dv1",["realtime",`openai-insecure-api-key.${o}`,"openai-beta.realtime-v1"]),new Promise(o=>{let i,a=!1;this.ws.onopen=async()=>{this.log(5,"✅ Connected to ChatGPT Realtime API");const r=`You are a language learning tutor. The user will attempt to translate "${e}" from ${this.sourceLanguage} into ${this.targetLanguage}. Your job is to:\n\n1. Listen to their pronunciation and translation attempt in ${this.targetLanguage}\n2. Rate their overall performance from 1-10 (1=can't translate, 4=most words correct, but some missing, 6=words correct, but pronunciation is poor, 8=Right words, OK pronunciation, 10=perfect!) considering both:\n   - Translation accuracy (did they get the meaning right?)\n   - Pronunciation quality (does it sound like proper ${this.targetLanguage}?)\n3. Special cases:\n   - If they say "I don't know", "I give up", "skip", "pass", or similar phrases in ${this.sourceLanguage}, give them a score of 1 and provide encouraging feedback\n   - If they say "again", "play it again", "repeat", "one more time", or similar in any language, give them a score of 0 with commentary explaining they'll hear it again\n   - If they say "stop", "pause", "that's enough", "quit", "finish", "done" or similar in any language, respond with {"score": 0, "commentary": "User requested to stop", "stop": true}\n   - If they remain completely silent, score them 0 with appropriate commentary\n4. Provide specific, helpful commentary on their attempt including:\n   - Specific tips for better ${this.targetLanguage} pronunciation\n   - For "I don't know" responses, provide the correct answer and encouragement\n   - For "again" requests, acknowledge they'll hear the phrase repeated\n\nRespond with a JSON object in this exact format:\n{\n    "score": [0-10],\n    "commentary": "Detailed feedback on their pronunciation and translation accuracy, including specific suggestions for improvement",\n    "stop": false\n}\n\nIMPORTANT: Your response must be valid JSON only. Do not include any text outside the JSON object.`;if(this.options.loggingVerbosity>=8&&(this.log(8,"📤 Sending prompt to ChatGPT:"),this.log(8,"------- PROMPT START -------"),this.log(8,r),this.log(8,"------- PROMPT END -------")),this.ws.send(JSON.stringify({type:"session.update",session:{modalities:["text"],instructions:r,input_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"server_vad",threshold:this.options.vad.threshold,prefix_padding_ms:this.options.vad.prefixPaddingMs,silence_duration_ms:this.options.vad.silenceDurationMs}}})),!this.isLearningSessionActive)return this.logError(2,"❌ test() called without active learning session"),{score:0,commentary:"No active learning session. Please start a learning session first.",stop:!0};this.log(6,"🎤 Using persistent microphone session");if(0===s.reduce((e,t)=>e+t,0))this.showStatus(`🎵 New phrase! Listen to this ${this.sourceLanguage} phrase...`),this.pauseListening(),await this.speakText(e,this.sourceLanguage),this.showStatus(`🎵 Now here's how to say it in ${this.targetLanguage}...`),await this.speakText(t,this.targetLanguage),await new Promise(e=>setTimeout(e,1e3)),await this.speakText(t,this.targetLanguage),this.showStatus(`🎤 Now you try! Say it in ${this.targetLanguage}...`),await this.playNotificationBleep(),this.resumeListening();else{if(this.showStatus(`🎵 Listen to this ${this.sourceLanguage} phrase...`),this.pauseListening(),await this.speakText(e,this.sourceLanguage),this.options.enableAudioHints&&this.shouldPlayHint(t,s))try{this.showStatus("🎯 Here is a hint for you..."),this.log(6,"🎯 Playing audio hint for struggling phrase"),await this.playAudioHint(t),await new Promise(e=>setTimeout(e,500))}catch(e){this.log(4,"⚠️ Audio hint failed:",e)}this.showStatus(`🎤 Now say it in ${this.targetLanguage}...`),await this.playNotificationBleep(),this.resumeListening()}i=setTimeout(()=>{a||(this.log(4,"⏰ Silence timeout reached"),this.cleanup(),o({score:0,commentary:"No response detected within the time limit. Please try speaking closer to the microphone or check your audio settings.",stop:!1}))},1e3*n)},this.ws.onmessage=async e=>{const s=JSON.parse(e.data);if(this.log(8,"📨 Received message:",s.type),["response.done","error","response.text.delta"].includes(s.type)&&this.log(9,"📋 Full message details:",s),"session.updated"===s.type&&this.log(6,"✅ Session configured successfully"),"input_audio_buffer.speech_started"===s.type&&(this.log(6,"🎤 Speech detected, user started speaking"),clearTimeout(i)),"input_audio_buffer.speech_stopped"===s.type&&this.log(6,"🔇 Speech stopped, processing..."),"response.done"===s.type){this.log(5,"✅ Response complete from ChatGPT"),a=!0,clearTimeout(i);const e=s.response;let n={score:0,commentary:"Unable to process response",stop:!1};if(this.log(6,"🔍 Processing ChatGPT response..."),this.log(9,"📥 Raw response object:",JSON.stringify(e,null,2)),e.output&&e.output.length>0){for(const t of e.output)if(this.log(8,"📄 Processing output item:",t),t.content&&t.content.length>0)for(const e of t.content)if("text"===e.type&&e.text){this.options.loggingVerbosity>=7&&(this.log(7,"📥 Raw ChatGPT response text:"),this.log(7,"------- RESPONSE START -------"),this.log(7,e.text),this.log(7,"------- RESPONSE END -------"));try{const t=JSON.parse(e.text);this.log(6,"✅ Successfully parsed JSON response:",t),n={score:parseInt(t.score)||0,commentary:t.commentary||"No commentary provided",stop:Boolean(t.stop)},this.log(5,"📊 Processed result:",n)}catch(t){this.logWarn(4,"❌ Failed to parse JSON response, attempting fallback parsing"),this.logWarn(6,"Parse error:",t.message);const s=e.text.match(/score["\s]*:["\s]*(\d+)/i),o=e.text.toLowerCase().includes("stop")||e.text.toLowerCase().includes("pause")||e.text.toLowerCase().includes("enough");n={score:s?parseInt(s[1]):0,commentary:e.text,stop:o},this.log(5,"🔧 Fallback parsed result:",n)}}}else this.logWarn(3,"⚠️ No output found in ChatGPT response");if(n.stop)return this.log(4,"🛑 User requested to stop"),this.cleanup(),void o(n);this.showStatus("Test complete!");this.showScore(n.score);if(n.score>0&&n.score<=this.options.feedbackThreshold){this.log(5,`📢 Score ${n.score} below threshold ${this.options.feedbackThreshold}, speaking ${this.targetLanguage} target phrase...`);const e=this.isListening;if(e&&this.pauseListening(),n.score<3){this.log(4,`🔁 Score ${n.score} is very low, repeating target phrase 3 times for better learning`),this.showStatus(`🎵 Score ${n.score}/10 - Here's the ${this.targetLanguage} pronunciation (3 times)...`);for(let e=1;e<=3;e++)this.log(6,`🎵 Playing repetition ${e}/3`),await this.speakText(t,this.targetLanguage),e<3&&await new Promise(e=>setTimeout(e,800))}else this.showStatus(`🎵 Here's the ${this.targetLanguage} pronunciation...`),await this.speakText(t,this.targetLanguage);e&&this.resumeListening()}this.log(4,"📊 Final result returned:",n),this.cleanup(),o(n)}"error"===s.type&&(this.logError(2,"❌ ChatGPT WebSocket error:",s.error),this.log(8,"💥 Full error details:",JSON.stringify(s,null,2)),this.showError("Error: "+s.error.message),this.cleanup(),o({score:0,commentary:`Error occurred: ${s.error.message}`,stop:!1}))},this.ws.onerror=e=>{this.logError(2,"❌ WebSocket connection error:",e),this.showError("Connection error occurred"),this.cleanup(),o({score:0,commentary:"Connection error occurred. Please check your internet connection and try again.",stop:!1})}})):{score:0,commentary:"Failed to get session key",stop:!1}}catch(e){return this.logError(1,"💥 Error in test method:",e),this.log(8,"🔍 Error stack trace:",e.stack),this.showError("Error: "+e.message),{score:0,commentary:`Error occurred: ${e.message}`,stop:!1}}}cleanup(){this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.log(5,"🔌 Closing ChatGPT WebSocket connection"),this.ws.close(),this.ws=null),this.isLearningSessionActive?this.log(6,"🎤 Keeping persistent microphone session active"):(this.log(6,"🎤 Stopping temporary recording session"),this.stopRecording())}destroy(){this.log(4,"🧹 Destroying LanguageTutor instance"),this.cleanup(),this.stopKeyRefreshTimer()}}const Z=[];const X={nativeLanguage:"English",learningLanguage:"Italian",showExpectedOutput:"always",showCategory:!0,showFeedback:!0,showUpcomingQueue:!1,enableAudioHints:!1,translationThreshold:7,pauseBetweenTests:3,pauseWhenStruggling:5,passThreshold:7,repetitivenessFactor:5,loggingVerbosity:5,showDeveloperSettings:!1,enabledCategories:{}};const ee=function(){const{subscribe:t,set:s,update:n}=function(t,s=e){let n;const o=new Set;function a(e){if(i(t,e)&&(t=e,n)){const e=!Z.length;for(const e of o)e[1](),Z.push(e,t);if(e){for(let e=0;e<Z.length;e+=2)Z[e][0](Z[e+1]);Z.length=0}}}return{set:a,update:function(e){a(e(t))},subscribe:function(i,r=e){const l=[i,r];return o.add(l),1===o.size&&(n=s(a)||e),i(t),()=>{o.delete(l),0===o.size&&n&&(n(),n=null)}}}}(X);return{subscribe:t,load:()=>{if("undefined"==typeof localStorage)return;const e=localStorage.getItem("languageTutorSettings");if(e)try{const t=JSON.parse(e);n(e=>({...e,...t})),console.log("✅ Settings loaded from localStorage")}catch(e){console.error("❌ Failed to parse saved settings:",e)}},save:e=>{if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(e)),console.log("💾 Settings saved to localStorage")}catch(e){console.error("❌ Failed to save settings:",e)}},updateSetting:(e,t)=>{n(s=>{const n={...s,[e]:t};if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(n))}catch(e){console.error("❌ Failed to save setting:",e)}return n})},updateSettings:e=>{n(t=>{const s={...t,...e};if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(s))}catch(e){console.error("❌ Failed to save settings:",e)}return s})},reset:()=>{s(X),"undefined"!=typeof localStorage&&localStorage.removeItem("languageTutorSettings")}}}();function te(e,t){function s(e){const s="checkbox"===e.target.type?e.target.checked:e.target.value;if(t&&"undefined"!=typeof localStorage)try{const e=localStorage.getItem("languageTutorSettings"),n=e?JSON.parse(e):{};n[t]=s,localStorage.setItem("languageTutorSettings",JSON.stringify(n)),console.log(`💾 Saved ${t}:`,s)}catch(e){console.error(`Failed to save ${t}:`,e)}}return e.addEventListener("change",s),{destroy(){e.removeEventListener("change",s)}}}function se(e,t,s){const n=e.slice();return n[9]=t[s],n}function ne(e,t,s){const n=e.slice();return n[9]=t[s],n}function oe(e){let t,s,n,o,i=e[9]+"";return{c(){t=g("option"),s=h(i),n=d(),t.__value=o=e[9],t.value=t.__value},m(e,o){l(e,t,o),r(t,s),r(t,n)},p(e,n){4&n&&i!==(i=e[9]+"")&&b(s,i),4&n&&o!==(o=e[9])&&(t.__value=o,t.value=t.__value)},d(e){e&&c(t)}}}function ie(e){let t,s,n,o,i=e[9]+"";return{c(){t=g("option"),s=h(i),n=d(),t.__value=o=e[9],t.value=t.__value},m(e,o){l(e,t,o),r(t,s),r(t,n)},p(e,n){8&n&&i!==(i=e[9]+"")&&b(s,i),8&n&&o!==(o=e[9])&&(t.__value=o,t.value=t.__value)},d(e){e&&c(t)}}}function ae(t){let s,o,i,h,p,y,b,w,$,S,T,L,x,k,C=t[2],E=[];for(let e=0;e<C.length;e+=1)E[e]=oe(ne(t,C,e));let R=t[3],A=[];for(let e=0;e<R.length;e+=1)A[e]=ie(se(t,R,e));return{c(){s=g("h3"),s.textContent="Language Selection",o=d(),i=g("div"),h=g("div"),p=g("label"),p.textContent="Native Language",y=d(),b=g("select");for(let e=0;e<E.length;e+=1)E[e].c();w=d(),$=g("div"),S=g("label"),S.textContent="Learning Language",T=d(),L=g("select");for(let e=0;e<A.length;e+=1)A[e].c();m(s,"class","section-header"),m(p,"class","form-label"),m(b,"class","form-select"),void 0===t[0]&&F(()=>t[5].call(b)),m(h,"class","form-group"),m(S,"class","form-label"),m(L,"class","form-select"),void 0===t[1]&&F(()=>t[6].call(L)),m($,"class","form-group"),m(i,"class","language-grid")},m(e,n){l(e,s,n),l(e,o,n),l(e,i,n),r(i,h),r(h,p),r(h,y),r(h,b);for(let e=0;e<E.length;e+=1)E[e]&&E[e].m(b,null);v(b,t[0],!0),r(i,w),r(i,$),r($,S),r($,T),r($,L);for(let e=0;e<A.length;e+=1)A[e]&&A[e].m(L,null);v(L,t[1],!0),x||(k=[f(b,"change",t[5]),a(te.call(null,b,"nativeLanguage")),f(L,"change",t[6]),a(te.call(null,L,"learningLanguage"))],x=!0)},p(e,[t]){if(4&t){let s;for(C=e[2],s=0;s<C.length;s+=1){const n=ne(e,C,s);E[s]?E[s].p(n,t):(E[s]=oe(n),E[s].c(),E[s].m(b,null))}for(;s<E.length;s+=1)E[s].d(1);E.length=C.length}if(5&t&&v(b,e[0]),8&t){let s;for(R=e[3],s=0;s<R.length;s+=1){const n=se(e,R,s);A[s]?A[s].p(n,t):(A[s]=ie(n),A[s].c(),A[s].m(L,null))}for(;s<A.length;s+=1)A[s].d(1);A.length=R.length}10&t&&v(L,e[1])},i:e,o:e,d(e){e&&c(s),e&&c(o),e&&c(i),u(E,e),u(A,e),x=!1,n(k)}}}function re(e,t,s){let{nativeLanguage:n}=t,{learningLanguage:o}=t,{nativeLanguages:i}=t,{learningLanguages:a}=t,{loggingVerbosity:r=5}=t;return k(),e.$$set=e=>{"nativeLanguage"in e&&s(0,n=e.nativeLanguage),"learningLanguage"in e&&s(1,o=e.learningLanguage),"nativeLanguages"in e&&s(2,i=e.nativeLanguages),"learningLanguages"in e&&s(3,a=e.learningLanguages),"loggingVerbosity"in e&&s(4,r=e.loggingVerbosity)},[n,o,i,a,r,function(){n=$(this),s(0,n),s(2,i)},function(){o=$(this),s(1,o),s(3,a)}]}class le extends z{constructor(e){super(),J(this,e,re,ae,i,{nativeLanguage:0,learningLanguage:1,nativeLanguages:2,learningLanguages:3,loggingVerbosity:4})}}function ce(e){let t;return{c(){t=h("Expected translation shown only for phrases with success rate below 25%")},m(e,s){l(e,t,s)},d(e){e&&c(t)}}}function ue(e){let t;return{c(){t=h("Expected translation is never shown - test your memory!")},m(e,s){l(e,t,s)},d(e){e&&c(t)}}}function ge(e){let t;return{c(){t=h("Expected translation is always shown")},m(e,s){l(e,t,s)},d(e){e&&c(t)}}}function he(e){let t,s,o,i,u,p,y,v,$,S,T,L;return{c(){t=g("div"),s=g("label"),o=h("Pause When Struggling: "),i=h(e[7]),u=h("s\n      "),p=g("span"),p.textContent="Extra pause time for phrases with low success rate (<25%) or poor scores (<4)",y=d(),v=g("input"),$=d(),S=g("div"),S.innerHTML="<span>Quick (0.5s)</span> \n      <span>Default (5s)</span> \n      <span>Extended (15s)</span>",m(p,"class","threshold-description"),m(s,"class","form-label"),m(v,"type","range"),m(v,"min","0.5"),m(v,"max","15"),m(v,"step","0.5"),m(v,"class","threshold-slider"),m(S,"class","threshold-labels"),m(t,"class","threshold-setting")},m(n,c){l(n,t,c),r(t,s),r(s,o),r(s,i),r(s,u),r(s,p),r(t,y),r(t,v),w(v,e[7]),r(t,$),r(t,S),T||(L=[f(v,"change",e[16]),f(v,"input",e[16]),a(te.call(null,v,"pauseWhenStruggling"))],T=!0)},p(e,t){128&t&&b(i,e[7]),128&t&&w(v,e[7])},d(e){e&&c(t),T=!1,n(L)}}}function de(t){let s,o,i,u,p,y,$,S,T,L,x,k,C,E,R,A,_,P,O,D,N,q,I,Q,H,V,M,U,B,W,j,K,J,z,G,Y,Z,X,ee,se,ne,oe,ie,ae,re,le,de,pe,fe,me,ye,be,we,ve,$e,Se,Te,Le,xe,ke,Ce=0===t[5]?"Never repeat translation":10===t[5]?"Always repeat translation":`Repeat translation for scores below ${t[5]}`,Ee=t[6]<=1?"Quick - brief pause for score review":t[6]>=5?"Slow - plenty of time to read feedback":"Balanced - comfortable time to review your score";function Re(e,t){return"always"===e[0]?ge:"never"===e[0]?ue:"struggling"===e[0]?ce:void 0}let Ae=Re(t),_e=Ae&&Ae(t),Pe="struggling"===t[0]&&he(t);return{c(){s=g("h3"),s.textContent="Display Options",o=d(),i=g("div"),u=g("div"),p=g("label"),y=g("input"),$=d(),S=g("span"),S.textContent="Display Category",T=d(),L=g("label"),x=g("input"),k=d(),C=g("span"),C.textContent="Display Feedback",E=d(),R=g("label"),A=g("input"),_=d(),P=g("span"),P.textContent="Show Upcoming Queue",O=d(),D=g("label"),N=g("input"),q=d(),I=g("span"),I.textContent="Enable Audio Hints",Q=d(),H=g("div"),V=g("label"),V.textContent="Show Expected Translation",M=d(),U=g("select"),B=g("option"),B.textContent="Always",W=g("option"),W.textContent="Only when struggling",j=g("option"),j.textContent="Never",K=d(),J=g("p"),_e&&_e.c(),z=d(),G=g("div"),Y=g("label"),Z=h("Translation Repetition Threshold: "),X=h(t[5]),ee=d(),se=g("span"),ne=h(Ce),oe=d(),ie=g("input"),ae=d(),re=g("div"),re.innerHTML="<span>Never (0)</span> \n      <span>Default (7)</span> \n      <span>Always (10)</span>",le=d(),de=g("div"),pe=g("label"),fe=h("Pause Between Tests: "),me=h(t[6]),ye=h("s\n      "),be=g("span"),we=h(Ee),ve=d(),$e=g("input"),Se=d(),Te=g("div"),Te.innerHTML="<span>Quick (0.5s)</span> \n      <span>Default (3s)</span> \n      <span>Slow (10s)</span>",Le=d(),Pe&&Pe.c(),m(s,"class","section-header"),m(y,"type","checkbox"),m(y,"class","category-checkbox"),m(S,"class","category-label"),m(p,"class","category-item"),m(x,"type","checkbox"),m(x,"class","category-checkbox"),m(C,"class","category-label"),m(L,"class","category-item"),m(A,"type","checkbox"),m(A,"class","category-checkbox"),m(P,"class","category-label"),m(R,"class","category-item"),m(N,"type","checkbox"),m(N,"class","category-checkbox"),m(I,"class","category-label"),m(D,"class","category-item"),m(u,"class","display-options-list svelte-6s5pe4"),m(V,"class","form-label"),m(V,"for","expected-output-select"),B.__value="always",B.value=B.__value,W.__value="struggling",W.value=W.__value,j.__value="never",j.value=j.__value,m(U,"id","expected-output-select"),m(U,"class","form-select"),void 0===t[0]&&F(()=>t[13].call(U)),m(J,"class","setting-description"),m(H,"class","form-group expected-translation-section svelte-6s5pe4"),m(se,"class","threshold-description"),m(Y,"class","form-label"),m(ie,"type","range"),m(ie,"min","0"),m(ie,"max","10"),m(ie,"step","1"),m(ie,"class","threshold-slider"),m(re,"class","threshold-labels"),m(G,"class","threshold-setting"),m(be,"class","threshold-description"),m(pe,"class","form-label"),m($e,"type","range"),m($e,"min","0.5"),m($e,"max","10"),m($e,"step","0.5"),m($e,"class","threshold-slider"),m(Te,"class","threshold-labels"),m(de,"class","threshold-setting"),m(i,"class","display-options-section")},m(e,n){l(e,s,n),l(e,o,n),l(e,i,n),r(i,u),r(u,p),r(p,y),y.checked=t[1],r(p,$),r(p,S),r(u,T),r(u,L),r(L,x),x.checked=t[2],r(L,k),r(L,C),r(u,E),r(u,R),r(R,A),A.checked=t[3],r(R,_),r(R,P),r(u,O),r(u,D),r(D,N),N.checked=t[4],r(D,q),r(D,I),r(i,Q),r(i,H),r(H,V),r(H,M),r(H,U),r(U,B),r(U,W),r(U,j),v(U,t[0],!0),r(H,K),r(H,J),_e&&_e.m(J,null),r(i,z),r(i,G),r(G,Y),r(Y,Z),r(Y,X),r(Y,ee),r(Y,se),r(se,ne),r(G,oe),r(G,ie),w(ie,t[5]),r(G,ae),r(G,re),r(i,le),r(i,de),r(de,pe),r(pe,fe),r(pe,me),r(pe,ye),r(pe,be),r(be,we),r(de,ve),r(de,$e),w($e,t[6]),r(de,Se),r(de,Te),r(i,Le),Pe&&Pe.m(i,null),xe||(ke=[f(y,"change",t[9]),a(te.call(null,y,"showCategory")),f(x,"change",t[10]),a(te.call(null,x,"showFeedback")),f(A,"change",t[11]),f(A,"change",t[8]),a(te.call(null,A,"showUpcomingQueue")),f(N,"change",t[12]),a(te.call(null,N,"enableAudioHints")),f(U,"change",t[13]),a(te.call(null,U,"showExpectedOutput")),f(ie,"change",t[14]),f(ie,"input",t[14]),a(te.call(null,ie,"translationThreshold")),f($e,"change",t[15]),f($e,"input",t[15]),a(te.call(null,$e,"pauseBetweenTests"))],xe=!0)},p(e,[t]){2&t&&(y.checked=e[1]),4&t&&(x.checked=e[2]),8&t&&(A.checked=e[3]),16&t&&(N.checked=e[4]),1&t&&v(U,e[0]),Ae!==(Ae=Re(e))&&(_e&&_e.d(1),_e=Ae&&Ae(e),_e&&(_e.c(),_e.m(J,null))),32&t&&b(X,e[5]),32&t&&Ce!==(Ce=0===e[5]?"Never repeat translation":10===e[5]?"Always repeat translation":`Repeat translation for scores below ${e[5]}`)&&b(ne,Ce),32&t&&w(ie,e[5]),64&t&&b(me,e[6]),64&t&&Ee!==(Ee=e[6]<=1?"Quick - brief pause for score review":e[6]>=5?"Slow - plenty of time to read feedback":"Balanced - comfortable time to review your score")&&b(we,Ee),64&t&&w($e,e[6]),"struggling"===e[0]?Pe?Pe.p(e,t):(Pe=he(e),Pe.c(),Pe.m(i,null)):Pe&&(Pe.d(1),Pe=null)},i:e,o:e,d(e){e&&c(s),e&&c(o),e&&c(i),_e&&_e.d(),Pe&&Pe.d(),xe=!1,n(ke)}}}function pe(e,t,s){let{showExpectedOutput:n}=t,{showCategory:o}=t,{showFeedback:i}=t,{showUpcomingQueue:a}=t,{enableAudioHints:r}=t,{translationThreshold:l}=t,{pauseBetweenTests:c}=t,{pauseWhenStruggling:u}=t;const g=k();return e.$$set=e=>{"showExpectedOutput"in e&&s(0,n=e.showExpectedOutput),"showCategory"in e&&s(1,o=e.showCategory),"showFeedback"in e&&s(2,i=e.showFeedback),"showUpcomingQueue"in e&&s(3,a=e.showUpcomingQueue),"enableAudioHints"in e&&s(4,r=e.enableAudioHints),"translationThreshold"in e&&s(5,l=e.translationThreshold),"pauseBetweenTests"in e&&s(6,c=e.pauseBetweenTests),"pauseWhenStruggling"in e&&s(7,u=e.pauseWhenStruggling)},[n,o,i,a,r,l,c,u,function(){g("updateQueue")},function(){o=this.checked,s(1,o)},function(){i=this.checked,s(2,i)},function(){a=this.checked,s(3,a)},function(){r=this.checked,s(4,r)},function(){n=$(this),s(0,n)},function(){l=y(this.value),s(5,l)},function(){c=y(this.value),s(6,c)},function(){u=y(this.value),s(7,u)}]}class fe extends z{constructor(e){super(),J(this,e,pe,de,i,{showExpectedOutput:0,showCategory:1,showFeedback:2,showUpcomingQueue:3,enableAudioHints:4,translationThreshold:5,pauseBetweenTests:6,pauseWhenStruggling:7})}}function me(t){let s,o,i,u,p,y,v,$,S,T,L,x,k,C,E,R,A,_,P,F,O,D,N,q,I,Q,H,V,M,U,B=t[1]<=3?"Less repetitive - tests advance quickly":t[1]>=8?"Very repetitive - tests stay at front longer":"Balanced repetition";return{c(){s=g("div"),o=g("h3"),o.textContent="Learning Algorithm",i=d(),u=g("div"),p=g("label"),y=h("Pass Threshold: "),v=h(t[0]),$=d(),S=g("span"),T=h("Scores "),L=h(t[0]),x=h(" and above are considered a pass"),k=d(),C=g("input"),E=d(),R=g("div"),R.innerHTML="<span>Easy (1)</span> \n      <span>Default (7)</span> \n      <span>Hard (10)</span>",A=d(),_=g("div"),P=g("label"),F=h("Test Repetitiveness: "),O=h(t[1]),D=d(),N=g("span"),q=h(B),I=d(),Q=g("input"),H=d(),V=g("div"),V.innerHTML="<span>Less (1)</span> \n      <span>Default (5)</span> \n      <span>More (10)</span>",m(o,"class","section-header"),m(S,"class","threshold-description"),m(p,"class","form-label"),m(C,"type","range"),m(C,"min","1"),m(C,"max","10"),m(C,"step","1"),m(C,"class","threshold-slider"),m(R,"class","threshold-labels"),m(u,"class","threshold-setting"),m(N,"class","threshold-description"),m(P,"class","form-label"),m(Q,"type","range"),m(Q,"min","1"),m(Q,"max","10"),m(Q,"step","1"),m(Q,"class","threshold-slider"),m(V,"class","threshold-labels"),m(_,"class","threshold-setting"),m(s,"class","algorithm-settings svelte-1xttx29")},m(e,n){l(e,s,n),r(s,o),r(s,i),r(s,u),r(u,p),r(p,y),r(p,v),r(p,$),r(p,S),r(S,T),r(S,L),r(S,x),r(u,k),r(u,C),w(C,t[0]),r(u,E),r(u,R),r(s,A),r(s,_),r(_,P),r(P,F),r(P,O),r(P,D),r(P,N),r(N,q),r(_,I),r(_,Q),w(Q,t[1]),r(_,H),r(_,V),M||(U=[f(C,"change",t[2]),f(C,"input",t[2]),a(te.call(null,C,"passThreshold")),f(Q,"change",t[3]),f(Q,"input",t[3]),a(te.call(null,Q,"repetitivenessFactor"))],M=!0)},p(e,[t]){1&t&&b(v,e[0]),1&t&&b(L,e[0]),1&t&&w(C,e[0]),2&t&&b(O,e[1]),2&t&&B!==(B=e[1]<=3?"Less repetitive - tests advance quickly":e[1]>=8?"Very repetitive - tests stay at front longer":"Balanced repetition")&&b(q,B),2&t&&w(Q,e[1])},i:e,o:e,d(e){e&&c(s),M=!1,n(U)}}}function ye(e,t,s){let{passThreshold:n}=t,{repetitivenessFactor:o}=t;return e.$$set=e=>{"passThreshold"in e&&s(0,n=e.passThreshold),"repetitivenessFactor"in e&&s(1,o=e.repetitivenessFactor)},[n,o,function(){n=y(this.value),s(0,n)},function(){o=y(this.value),s(1,o)}]}class be extends z{constructor(e){super(),J(this,e,ye,me,i,{passThreshold:0,repetitivenessFactor:1})}}function we(e,t,s){const n=e.slice();return n[7]=t[s],n}function ve(e){let t,s,n,o,i,a,h,p=!Object.values(e[0]).some(Le),f=e[1],y=[];for(let t=0;t<f.length;t+=1)y[t]=$e(we(e,f,t));let b=p&&Se();return{c(){t=g("h3"),t.textContent="Learning Categories",s=d(),n=g("div"),o=g("div");for(let e=0;e<y.length;e+=1)y[e].c();i=d(),b&&b.c(),a=d(),h=g("style"),h.textContent="/* Component-specific styles for CategoryManager */\n  .categories-section {\n    margin-top: 1rem;\n  }\n  \n  .categories-list {\n    margin-top: 0.5rem;\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n  }\n  \n  @media (min-width: 640px) {\n    .categories-list {\n      grid-template-columns: 1fr 1fr;\n    }\n  }\n  \n  /* Fieldset styling for categories */\n  fieldset {\n    border: none;\n    padding: 0;\n    margin: 0;\n  }\n  \n  legend {\n    padding: 0;\n    margin-bottom: 0.5rem;\n  }",m(t,"class","section-header"),m(o,"class","categories-list"),m(n,"class","categories-section")},m(e,c){l(e,t,c),l(e,s,c),l(e,n,c),r(n,o);for(let e=0;e<y.length;e+=1)y[e]&&y[e].m(o,null);r(n,i),b&&b.m(n,null),r(n,a),r(n,h)},p(e,t){if(7&t){let s;for(f=e[1],s=0;s<f.length;s+=1){const n=we(e,f,s);y[s]?y[s].p(n,t):(y[s]=$e(n),y[s].c(),y[s].m(o,null))}for(;s<y.length;s+=1)y[s].d(1);y.length=f.length}1&t&&(p=!Object.values(e[0]).some(Le)),p?b||(b=Se(),b.c(),b.m(n,a)):b&&(b.d(1),b=null)},d(e){e&&c(t),e&&c(s),e&&c(n),u(y,e),b&&b.d()}}}function $e(e){let t,s,n,o,i,a,u,p,y,w=e[7]+"";function v(...t){return e[4](e[7],...t)}return{c(){t=g("label"),s=g("input"),o=d(),i=g("span"),a=h(w),u=d(),m(s,"type","checkbox"),m(s,"class","category-checkbox"),s.checked=n=e[0][e[7]]||!1,m(i,"class","category-label"),m(t,"class","category-item")},m(e,n){l(e,t,n),r(t,s),r(t,o),r(t,i),r(i,a),r(t,u),p||(y=f(s,"change",v),p=!0)},p(t,o){e=t,3&o&&n!==(n=e[0][e[7]]||!1)&&(s.checked=n),2&o&&w!==(w=e[7]+"")&&b(a,w)},d(e){e&&c(t),p=!1,y()}}}function Se(e){let t;return{c(){t=g("div"),t.textContent="At least one category must be enabled to start learning!",m(t,"class","error-text")},m(e,s){l(e,t,s)},d(e){e&&c(t)}}}function Te(t){let s,n=t[1].length>0&&ve(t);return{c(){n&&n.c(),s=p()},m(e,t){n&&n.m(e,t),l(e,s,t)},p(e,[t]){e[1].length>0?n?n.p(e,t):(n=ve(e),n.c(),n.m(s.parentNode,s)):n&&(n.d(1),n=null)},i:e,o:e,d(e){n&&n.d(e),e&&c(s)}}}const Le=e=>e;function xe(e,t,s){let{categories:n}=t,{enabledCategories:o}=t,{loggingVerbosity:i=5}=t;const a=k();function r(e,t){if(function(e,...t){i>=e&&console.log(...t)}(6,`🔘 Category toggle: ${e} → ${t}`),s(0,o[e]=t,o),s(0,o={...o}),"undefined"!=typeof localStorage)try{const s=localStorage.getItem("languageTutorSettings"),n=s?JSON.parse(s):{};n.enabledCategories||(n.enabledCategories={}),n.enabledCategories[e]=t,localStorage.setItem("languageTutorSettings",JSON.stringify(n)),console.log(`💾 Saved category ${e}:`,t)}catch(t){console.error(`Failed to save category ${e}:`,t)}a("categoryChange",{category:e,enabled:t})}return e.$$set=e=>{"categories"in e&&s(1,n=e.categories),"enabledCategories"in e&&s(0,o=e.enabledCategories),"loggingVerbosity"in e&&s(3,i=e.loggingVerbosity)},[o,n,r,i,(e,t)=>r(e,t.target.checked)]}class ke extends z{constructor(e){super(),J(this,e,xe,Te,i,{categories:1,enabledCategories:0,loggingVerbosity:3})}}function Ce(e){let t,s,o,i,a,u,p,y,v,$,S,T,L,x,k,C,E,R,A,_,P,F=0===e[0]?"Silent - no console output":e[0]<=3?"Quiet - errors and warnings only":e[0]<=6?"Normal - important events":"Verbose - detailed debugging info";return{c(){t=g("div"),s=g("h3"),s.textContent="🛠️ Developer Settings",o=d(),i=g("div"),a=g("label"),u=h("Console Logging Verbosity: "),p=h(e[0]),y=d(),v=g("span"),$=h(F),S=d(),T=g("input"),L=d(),x=g("div"),x.innerHTML="<span>Silent (0)</span> \n        <span>Default (5)</span> \n        <span>Verbose (10)</span>",k=d(),C=g("div"),E=g("button"),E.textContent="✅ Pass Next Test",R=d(),A=g("button"),A.textContent="❌ Fail Next Test",m(s,"class","section-header"),m(v,"class","threshold-description"),m(a,"class","form-label"),m(T,"type","range"),m(T,"min","0"),m(T,"max","10"),m(T,"step","1"),m(T,"class","threshold-slider"),m(x,"class","threshold-labels"),m(E,"class","debug-btn pass-btn svelte-w1gebj"),m(A,"class","debug-btn fail-btn svelte-w1gebj"),m(C,"class","debug-buttons svelte-w1gebj"),m(i,"class","threshold-setting developer-setting svelte-w1gebj"),m(t,"class","developer-settings svelte-w1gebj")},m(n,c){l(n,t,c),r(t,s),r(t,o),r(t,i),r(i,a),r(a,u),r(a,p),r(a,y),r(a,v),r(v,$),r(i,S),r(i,T),w(T,e[0]),r(i,L),r(i,x),r(i,k),r(i,C),r(C,E),r(C,R),r(C,A),_||(P=[f(T,"change",e[3]),f(T,"input",e[3]),f(E,"click",e[4]),f(A,"click",e[5])],_=!0)},p(e,t){1&t&&b(p,e[0]),1&t&&F!==(F=0===e[0]?"Silent - no console output":e[0]<=3?"Quiet - errors and warnings only":e[0]<=6?"Normal - important events":"Verbose - detailed debugging info")&&b($,F),1&t&&w(T,e[0])},d(e){e&&c(t),_=!1,n(P)}}}function Ee(t){let s,n=t[1]&&Ce(t);return{c(){n&&n.c(),s=p()},m(e,t){n&&n.m(e,t),l(e,s,t)},p(e,[t]){e[1]?n?n.p(e,t):(n=Ce(e),n.c(),n.m(s.parentNode,s)):n&&(n.d(1),n=null)},i:e,o:e,d(e){n&&n.d(e),e&&c(s)}}}function Re(e,t,s){let{showDeveloperSettings:n}=t,{loggingVerbosity:o}=t;const i=k();return e.$$set=e=>{"showDeveloperSettings"in e&&s(1,n=e.showDeveloperSettings),"loggingVerbosity"in e&&s(0,o=e.loggingVerbosity)},[o,n,i,function(){o=y(this.value),s(0,o)},()=>i("debugTest",{action:"pass"}),()=>i("debugTest",{action:"fail"})]}class Ae extends z{constructor(e){super(),J(this,e,Re,Ee,i,{showDeveloperSettings:1,loggingVerbosity:0})}}function _e(t){let s;return{c(){s=g("p"),s.textContent="Ready to start learning",m(s,"class","placeholder-text")},m(e,t){l(e,s,t)},p:e,d(e){e&&c(s)}}}function Pe(e){let t,s,n,o,i,a,u,p=e[0].source+"",f=e[6](e[0]),y=e[4]&&Fe(e),w=f&&Oe(e);return{c(){t=g("div"),y&&y.c(),s=d(),n=g("p"),n.textContent="Translate this:",o=d(),i=g("p"),a=h(p),u=d(),w&&w.c(),m(n,"class","phrase-label"),m(i,"class","phrase-text"),m(t,"class","phrase-content")},m(e,c){l(e,t,c),y&&y.m(t,null),r(t,s),r(t,n),r(t,o),r(t,i),r(i,a),r(t,u),w&&w.m(t,null)},p(e,n){e[4]?y?y.p(e,n):(y=Fe(e),y.c(),y.m(t,s)):y&&(y.d(1),y=null),1&n&&p!==(p=e[0].source+"")&&b(a,p),1&n&&(f=e[6](e[0])),f?w?w.p(e,n):(w=Oe(e),w.c(),w.m(t,null)):w&&(w.d(1),w=null)},d(e){e&&c(t),y&&y.d(),w&&w.d()}}}function Fe(e){let t,s,n,o=e[0].category+"";return{c(){t=g("p"),s=h("Category: "),n=h(o),m(t,"class","phrase-category")},m(e,o){l(e,t,o),r(t,s),r(t,n)},p(e,t){1&t&&o!==(o=e[0].category+"")&&b(n,o)},d(e){e&&c(t)}}}function Oe(e){let t,s,n,o=e[0].target+"";return{c(){t=g("p"),s=h("Expected: "),n=h(o),m(t,"class","expected-text")},m(e,o){l(e,t,o),r(t,s),r(t,n)},p(e,t){1&t&&o!==(o=e[0].target+"")&&b(n,o)},d(e){e&&c(t)}}}function De(t){let s;return{c(){s=g("p"),s.textContent="Ready to start learning!",m(s,"class","status-text")},m(e,t){l(e,s,t)},p:e,d(e){e&&c(s)}}}function Ne(t){let s;return{c(){s=g("p"),s.textContent="Listening...",m(s,"class","status-text")},m(e,t){l(e,s,t)},p:e,d(e){e&&c(s)}}}function qe(t){let s;return{c(){s=g("p"),s.textContent="🎯 Here is a hint for you",m(s,"class","status-text")},m(e,t){l(e,s,t)},p:e,d(e){e&&c(s)}}}function Ie(e){let t,s;return{c(){t=g("p"),s=h(e[1]),m(t,"class","status-text")},m(e,n){l(e,t,n),r(t,s)},p(e,t){2&t&&b(s,e[1])},d(e){e&&c(t)}}}function Qe(t){let s,n,o,i,a,u,p,y,w,v,$,S,T,L,x,k=t[2]?"⏹️":"▶️",C=t[2]?"Stop Learning":"Start Learning";function E(e,t){return e[0]?Pe:_e}let R=E(t),A=R(t);function _(e,t){return 1&t&&(i=null),e[5]?Ie:(null==i&&(i=!(!e[0]||!e[7](e[0]))),i?qe:e[2]?Ne:De)}let P=_(t,-1),F=P(t);return{c(){s=g("div"),A.c(),n=d(),o=g("div"),F.c(),a=d(),u=g("div"),p=g("button"),y=g("span"),w=h(k),v=d(),$=h(C),m(s,"class","phrase-display"),m(o,"class","status-area"),m(y,"class","btn-icon"),m(p,"class",S="start-stop-btn "+(t[2]?"stop-btn":"start-btn")),p.disabled=T=!t[3]&&!t[2],m(u,"class","button-container")},m(e,i){l(e,s,i),A.m(s,null),l(e,n,i),l(e,o,i),F.m(o,null),l(e,a,i),l(e,u,i),r(u,p),r(p,y),r(y,w),r(p,v),r(p,$),L||(x=f(p,"click",t[8]),L=!0)},p(e,[t]){R===(R=E(e))&&A?A.p(e,t):(A.d(1),A=R(e),A&&(A.c(),A.m(s,null))),P===(P=_(e,t))&&F?F.p(e,t):(F.d(1),F=P(e),F&&(F.c(),F.m(o,null))),4&t&&k!==(k=e[2]?"⏹️":"▶️")&&b(w,k),4&t&&C!==(C=e[2]?"Stop Learning":"Start Learning")&&b($,C),4&t&&S!==(S="start-stop-btn "+(e[2]?"stop-btn":"start-btn"))&&m(p,"class",S),12&t&&T!==(T=!e[3]&&!e[2])&&(p.disabled=T)},i:e,o:e,d(e){e&&c(s),A.d(),e&&c(n),e&&c(o),F.d(),e&&c(a),e&&c(u),L=!1,x()}}}function He(e,t,s){let{currentPhrase:n}=t,{status:o}=t,{isLearning:i}=t,{canStart:a}=t,{showCategory:r}=t,{showFeedback:l}=t,{showExpectedOutput:c}=t,{enableAudioHints:u}=t,{nativeLanguage:g}=t,{learningLanguage:h}=t;const d=k();return e.$$set=e=>{"currentPhrase"in e&&s(0,n=e.currentPhrase),"status"in e&&s(1,o=e.status),"isLearning"in e&&s(2,i=e.isLearning),"canStart"in e&&s(3,a=e.canStart),"showCategory"in e&&s(4,r=e.showCategory),"showFeedback"in e&&s(5,l=e.showFeedback),"showExpectedOutput"in e&&s(9,c=e.showExpectedOutput),"enableAudioHints"in e&&s(10,u=e.enableAudioHints),"nativeLanguage"in e&&s(11,g=e.nativeLanguage),"learningLanguage"in e&&s(12,h=e.learningLanguage)},[n,o,i,a,r,l,function(e){if("always"===c)return!0;if("never"===c)return!1;if("struggling"===c){if(!e.recentResults||0===e.recentResults.length)return!0;return e.recentResults.filter(e=>1===e).length/e.recentResults.length<.25}return!0},function(e){if(!u||!e.recentResults||0===e.recentResults.length)return!1;const t=e.recentResults.filter(e=>1===e).length,s=t/e.recentResults.length;return t>0&&s<.5},function(){d("startStop")},c,u,g,h]}class Ve extends z{constructor(e){super(),J(this,e,He,Qe,i,{currentPhrase:0,status:1,isLearning:2,canStart:3,showCategory:4,showFeedback:5,showExpectedOutput:9,enableAudioHints:10,nativeLanguage:11,learningLanguage:12})}}function Me(e,t,s){const n=e.slice();return n[2]=t[s],n}function Ue(e){let t,s,n,o,i,a,p,f=e[1].length+"",y=e[1],w=[];for(let t=0;t<y.length;t+=1)w[t]=Be(Me(e,y,t));return{c(){t=g("div"),s=g("h3"),n=h("Complete Learning Queue ("),o=h(f),i=h(" items)"),a=d(),p=g("div");for(let e=0;e<w.length;e+=1)w[e].c();m(s,"class","queue-title"),m(p,"class","queue-list"),m(t,"class","queue-section")},m(e,c){l(e,t,c),r(t,s),r(s,n),r(s,o),r(s,i),r(t,a),r(t,p);for(let e=0;e<w.length;e+=1)w[e]&&w[e].m(p,null)},p(e,t){if(2&t&&f!==(f=e[1].length+"")&&b(o,f),2&t){let s;for(y=e[1],s=0;s<y.length;s+=1){const n=Me(e,y,s);w[s]?w[s].p(n,t):(w[s]=Be(n),w[s].c(),w[s].m(p,null))}for(;s<w.length;s+=1)w[s].d(1);w.length=y.length}},d(e){e&&c(t),u(w,e)}}}function Be(e){let t,s,n,o,i,a,u,p,f,y,w,v,$,T,L,x,k,C,E,R=e[2].position+"",A=e[2].source+"",_=e[2].category+"",P=0===e[2].recentResults.length?"New":`${(100*e[2].successRate).toFixed(0)}%`,F=e[2].recentResults.filter(je).length+"",O=e[2].recentResults.length+"";return{c(){t=g("div"),s=g("span"),n=h("#"),o=h(R),i=d(),a=g("span"),u=h(A),p=d(),f=g("span"),y=h(_),w=d(),v=g("span"),$=h(P),T=d(),L=g("span"),x=h(F),k=h("/"),C=h(O),E=d(),m(s,"class","queue-position"),m(a,"class","queue-text"),m(f,"class","queue-category"),m(v,"class","queue-success-rate"),S(v,"struggling",e[2].successRate<.3),S(v,"mastered",e[2].successRate>.7),m(L,"class","queue-success-count"),m(t,"class","queue-item"),S(t,"current",1===e[2].position)},m(e,c){l(e,t,c),r(t,s),r(s,n),r(s,o),r(t,i),r(t,a),r(a,u),r(t,p),r(t,f),r(f,y),r(t,w),r(t,v),r(v,$),r(t,T),r(t,L),r(L,x),r(L,k),r(L,C),r(t,E)},p(e,s){2&s&&R!==(R=e[2].position+"")&&b(o,R),2&s&&A!==(A=e[2].source+"")&&b(u,A),2&s&&_!==(_=e[2].category+"")&&b(y,_),2&s&&P!==(P=0===e[2].recentResults.length?"New":`${(100*e[2].successRate).toFixed(0)}%`)&&b($,P),2&s&&S(v,"struggling",e[2].successRate<.3),2&s&&S(v,"mastered",e[2].successRate>.7),2&s&&F!==(F=e[2].recentResults.filter(je).length+"")&&b(x,F),2&s&&O!==(O=e[2].recentResults.length+"")&&b(C,O),2&s&&S(t,"current",1===e[2].position)},d(e){e&&c(t)}}}function We(t){let s,n=t[0]&&t[1].length>0&&Ue(t);return{c(){n&&n.c(),s=p()},m(e,t){n&&n.m(e,t),l(e,s,t)},p(e,[t]){e[0]&&e[1].length>0?n?n.p(e,t):(n=Ue(e),n.c(),n.m(s.parentNode,s)):n&&(n.d(1),n=null)},i:e,o:e,d(e){n&&n.d(e),e&&c(s)}}}const je=e=>e;function Ke(e,t,s){let{showUpcomingQueue:n}=t,{upcomingQueue:o}=t;return e.$$set=e=>{"showUpcomingQueue"in e&&s(0,n=e.showUpcomingQueue),"upcomingQueue"in e&&s(1,o=e.upcomingQueue)},[n,o]}class Je extends z{constructor(e){super(),J(this,e,Ke,We,i,{showUpcomingQueue:0,upcomingQueue:1})}}function ze(e){let t,s,o,i,a,u,p,y,b,w,v,$,S,T,L,x,k,C,R,A,_,P,F,D,N,q,I,Q,H,K,J,z,G,Y,Z,X,ee;function te(t){e[22](t)}function se(t){e[23](t)}function ne(t){e[24](t)}function oe(t){e[25](t)}function ie(t){e[26](t)}function ae(t){e[27](t)}function re(t){e[28](t)}function ce(t){e[29](t)}s=new le({props:{nativeLanguage:e[3].nativeLanguage,learningLanguage:e[3].learningLanguage,nativeLanguages:e[11],learningLanguages:e[10],loggingVerbosity:e[3].loggingVerbosity}});let ue={};function ge(t){e[30](t)}function he(t){e[31](t)}void 0!==e[3].showExpectedOutput&&(ue.showExpectedOutput=e[3].showExpectedOutput),void 0!==e[3].showCategory&&(ue.showCategory=e[3].showCategory),void 0!==e[3].showFeedback&&(ue.showFeedback=e[3].showFeedback),void 0!==e[3].showUpcomingQueue&&(ue.showUpcomingQueue=e[3].showUpcomingQueue),void 0!==e[3].enableAudioHints&&(ue.enableAudioHints=e[3].enableAudioHints),void 0!==e[3].translationThreshold&&(ue.translationThreshold=e[3].translationThreshold),void 0!==e[3].pauseBetweenTests&&(ue.pauseBetweenTests=e[3].pauseBetweenTests),void 0!==e[3].pauseWhenStruggling&&(ue.pauseWhenStruggling=e[3].pauseWhenStruggling),i=new fe({props:ue}),E.push(()=>U(i,"showExpectedOutput",te)),E.push(()=>U(i,"showCategory",se)),E.push(()=>U(i,"showFeedback",ne)),E.push(()=>U(i,"showUpcomingQueue",oe)),E.push(()=>U(i,"enableAudioHints",ie)),E.push(()=>U(i,"translationThreshold",ae)),E.push(()=>U(i,"pauseBetweenTests",re)),E.push(()=>U(i,"pauseWhenStruggling",ce)),i.$on("updateQueue",e[14]);let de={};function pe(t){e[32](t)}void 0!==e[3].passThreshold&&(de.passThreshold=e[3].passThreshold),void 0!==e[3].repetitivenessFactor&&(de.repetitivenessFactor=e[3].repetitivenessFactor),T=new be({props:de}),E.push(()=>U(T,"passThreshold",ge)),E.push(()=>U(T,"repetitivenessFactor",he));let me={categories:e[2],loggingVerbosity:e[3].loggingVerbosity};function ye(t){e[33](t)}void 0!==e[3].enabledCategories&&(me.enabledCategories=e[3].enabledCategories),C=new ke({props:me}),E.push(()=>U(C,"enabledCategories",pe)),C.$on("categoryChange",e[12]);let we={showDeveloperSettings:e[3].showDeveloperSettings};return void 0!==e[3].loggingVerbosity&&(we.loggingVerbosity=e[3].loggingVerbosity),G=new Ae({props:we}),E.push(()=>U(G,"loggingVerbosity",ye)),G.$on("debugTest",e[13]),{c(){t=g("div"),B(s.$$.fragment),o=d(),B(i.$$.fragment),S=d(),B(T.$$.fragment),k=d(),B(C.$$.fragment),A=d(),_=g("div"),P=g("h3"),P.textContent="Management",F=d(),D=g("div"),N=g("button"),q=h("🗑️ Clear TTS Cache"),Q=d(),H=g("button"),K=h("🔄 Reset Learning Queue"),z=d(),B(G.$$.fragment),m(P,"class","section-header"),m(N,"class","management-btn clear-btn"),N.disabled=I=!e[1],m(H,"class","management-btn reset-btn"),H.disabled=J=!e[0],m(D,"class","management-buttons"),m(_,"class","management-section"),m(t,"class","settings-panel")},m(n,a){l(n,t,a),W(s,t,null),r(t,o),W(i,t,null),r(t,S),W(T,t,null),r(t,k),W(C,t,null),r(t,A),r(t,_),r(_,P),r(_,F),r(_,D),r(D,N),r(N,q),r(D,Q),r(D,H),r(H,K),r(t,z),W(G,t,null),Z=!0,X||(ee=[f(N,"click",e[20]),f(H,"click",e[21])],X=!0)},p(e,t){const n={};8&t[0]&&(n.nativeLanguage=e[3].nativeLanguage),8&t[0]&&(n.learningLanguage=e[3].learningLanguage),1024&t[0]&&(n.learningLanguages=e[10]),8&t[0]&&(n.loggingVerbosity=e[3].loggingVerbosity),s.$set(n);const o={};!a&&8&t[0]&&(a=!0,o.showExpectedOutput=e[3].showExpectedOutput,O(()=>a=!1)),!u&&8&t[0]&&(u=!0,o.showCategory=e[3].showCategory,O(()=>u=!1)),!p&&8&t[0]&&(p=!0,o.showFeedback=e[3].showFeedback,O(()=>p=!1)),!y&&8&t[0]&&(y=!0,o.showUpcomingQueue=e[3].showUpcomingQueue,O(()=>y=!1)),!b&&8&t[0]&&(b=!0,o.enableAudioHints=e[3].enableAudioHints,O(()=>b=!1)),!w&&8&t[0]&&(w=!0,o.translationThreshold=e[3].translationThreshold,O(()=>w=!1)),!v&&8&t[0]&&(v=!0,o.pauseBetweenTests=e[3].pauseBetweenTests,O(()=>v=!1)),!$&&8&t[0]&&($=!0,o.pauseWhenStruggling=e[3].pauseWhenStruggling,O(()=>$=!1)),i.$set(o);const r={};!L&&8&t[0]&&(L=!0,r.passThreshold=e[3].passThreshold,O(()=>L=!1)),!x&&8&t[0]&&(x=!0,r.repetitivenessFactor=e[3].repetitivenessFactor,O(()=>x=!1)),T.$set(r);const l={};4&t[0]&&(l.categories=e[2]),8&t[0]&&(l.loggingVerbosity=e[3].loggingVerbosity),!R&&8&t[0]&&(R=!0,l.enabledCategories=e[3].enabledCategories,O(()=>R=!1)),C.$set(l),(!Z||2&t[0]&&I!==(I=!e[1]))&&(N.disabled=I),(!Z||1&t[0]&&J!==(J=!e[0]))&&(H.disabled=J);const c={};8&t[0]&&(c.showDeveloperSettings=e[3].showDeveloperSettings),!Y&&8&t[0]&&(Y=!0,c.loggingVerbosity=e[3].loggingVerbosity,O(()=>Y=!1)),G.$set(c)},i(e){Z||(V(s.$$.fragment,e),V(i.$$.fragment,e),V(T.$$.fragment,e),V(C.$$.fragment,e),V(G.$$.fragment,e),Z=!0)},o(e){M(s.$$.fragment,e),M(i.$$.fragment,e),M(T.$$.fragment,e),M(C.$$.fragment,e),M(G.$$.fragment,e),Z=!1},d(e){e&&c(t),j(s),j(i),j(T),j(C),j(G),X=!1,n(ee)}}}function Ge(e){let t,s,o,i,a,u,p,y,w,v,$,T,L,x,k,C,E,R,A=e[4]?"⬆️":"⬇️";i=new Ve({props:{currentPhrase:e[6],status:e[7],isLearning:e[5],canStart:e[9],showCategory:e[3].showCategory,showFeedback:e[3].showFeedback,showExpectedOutput:e[3].showExpectedOutput,enableAudioHints:e[3].enableAudioHints,nativeLanguage:e[3].nativeLanguage,learningLanguage:e[3].learningLanguage}}),i.$on("startStop",e[15]);let _=e[4]&&ze(e);return k=new Je({props:{showUpcomingQueue:e[3].showUpcomingQueue,upcomingQueue:e[8]}}),{c(){t=g("main"),s=g("div"),s.innerHTML="<h1>Language Tutor</h1> \n    <p>Your personal AI language learning companion</p>",o=d(),B(i.$$.fragment),a=d(),u=g("div"),p=g("button"),y=g("span"),y.textContent="⚙️",w=h("\n      Settings\n      "),v=g("span"),$=h(A),L=d(),_&&_.c(),x=d(),B(k.$$.fragment),m(s,"class","title"),m(y,"class","settings-icon svelte-15o4qf2"),S(y,"developer-mode",e[3].showDeveloperSettings),m(v,"class","chevron-icon"),m(p,"class","settings-toggle"),m(p,"title",T=e[3].showDeveloperSettings?"Developer mode active! Long press again to disable.":"Long press for developer settings"),m(u,"class","settings-section"),m(t,"class","app-container")},m(n,c){l(n,t,c),r(t,s),r(t,o),W(i,t,null),r(t,a),r(t,u),r(u,p),r(p,y),r(p,w),r(p,v),r(v,$),r(u,L),_&&_.m(u,null),r(t,x),W(k,t,null),C=!0,E||(R=[f(p,"click",e[16]),f(p,"mousedown",e[17]),f(p,"mouseup",e[18]),f(p,"mouseleave",e[19]),f(p,"touchstart",e[17],{passive:!0}),f(p,"touchend",e[18],{passive:!0})],E=!0)},p(e,t){const s={};64&t[0]&&(s.currentPhrase=e[6]),128&t[0]&&(s.status=e[7]),32&t[0]&&(s.isLearning=e[5]),512&t[0]&&(s.canStart=e[9]),8&t[0]&&(s.showCategory=e[3].showCategory),8&t[0]&&(s.showFeedback=e[3].showFeedback),8&t[0]&&(s.showExpectedOutput=e[3].showExpectedOutput),8&t[0]&&(s.enableAudioHints=e[3].enableAudioHints),8&t[0]&&(s.nativeLanguage=e[3].nativeLanguage),8&t[0]&&(s.learningLanguage=e[3].learningLanguage),i.$set(s),(!C||8&t[0])&&S(y,"developer-mode",e[3].showDeveloperSettings),(!C||16&t[0])&&A!==(A=e[4]?"⬆️":"⬇️")&&b($,A),(!C||8&t[0]&&T!==(T=e[3].showDeveloperSettings?"Developer mode active! Long press again to disable.":"Long press for developer settings"))&&m(p,"title",T),e[4]?_?(_.p(e,t),16&t[0]&&V(_,1)):(_=ze(e),_.c(),V(_,1),_.m(u,null)):_&&(H={r:0,c:[],p:H},M(_,1,1,()=>{_=null}),H.r||n(H.c),H=H.p);const o={};8&t[0]&&(o.showUpcomingQueue=e[3].showUpcomingQueue),256&t[0]&&(o.upcomingQueue=e[8]),k.$set(o)},i(e){C||(V(i.$$.fragment,e),V(_),V(k.$$.fragment,e),C=!0)},o(e){M(i.$$.fragment,e),M(_),M(k.$$.fragment,e),C=!1},d(e){e&&c(t),j(i),_&&_.d(),j(k),E=!1,n(R)}}}function Ye(e,t,s){let n,o,i=!1,a=!1,r=null,l="Ready to start learning!",c=null,u=null,g=[],h=[],d=!1,p={};ee.subscribe(e=>{const t=p;s(3,p=e),!d||t.nativeLanguage===e.nativeLanguage&&t.learningLanguage===e.learningLanguage||async function(){(c||u)&&(await w(),v())}()});const f={English:["Italian","Spanish"]},m=Object.keys(f);function y(e,...t){p.loggingVerbosity>=e&&console.log(...t)}var b;async function w(){y(5,"🏗️ Initializing LearningQueue for:",p.nativeLanguage,"→",p.learningLanguage),s(2,g=[]),s(0,c=new G(p.nativeLanguage,p.learningLanguage,"basic","learning/",{passThreshold:p.passThreshold,memoryLength:20,repetitivenessFactor:p.repetitivenessFactor})),await c.init();const e=c.getCategories();s(2,g=e);const t={};e.forEach(e=>{t[e]=p.enabledCategories[e]??!0,c.setCategory(e,t[e])}),ee.updateSetting("enabledCategories",t),$(),y(5,"✅ LearningQueue initialization complete")}function v(){s(1,u=new Y(null,p.nativeLanguage,p.learningLanguage,{apiKeyEndpoint:"openai.php",feedbackThreshold:p.translationThreshold,loggingVerbosity:p.loggingVerbosity,audioPath:"audio/",enableAudioHints:p.enableAudioHints,statusCallback:e=>{!p.showFeedback&&a?e.includes("Listen to this")?s(7,l=`Listen to the ${p.nativeLanguage} phrase...`):e.includes("Now say it in")&&s(7,l=`Now say it in ${p.learningLanguage}...`):s(7,l=e)}}))}function $(){c&&p.showUpcomingQueue&&(s(8,h=c.getTopQueueItems()),y(7,"📋 Updated upcoming queue:",h.length,"items"))}async function S(){if(c&&u)try{y(5,"🎓 Starting persistent microphone session for learning"),await u.startLearningSession(),s(5,a=!0),s(7,l="Right then, let's get cracking!"),await async function(){for(;a;){const e=c.getNextTest();if(!e){s(7,l="No more phrases available! Check your category settings."),L();break}if(y(8,"📋 Got phrase from queue:",e),y(8,"📊 Phrase recentResults:",e.recentResults,"length:",e.recentResults?.length),s(6,r=e),s(7,l=`Ready to listen to ${p.nativeLanguage} phrase...`),!a)break;try{const t=await u.test(e.source,e.target,e.recentResults||[]);if(t.stop||!a){L();break}if(0===t.score)s(7,l=`No response detected - ${t.commentary}`),y(6,`⏳ Pausing ${p.pauseBetweenTests} seconds before repeating phrase`),await new Promise(e=>setTimeout(e,1e3*p.pauseBetweenTests));else{c.scoreCurrentTest(t.score),$(),s(7,l=`Score: ${t.score}/10 - ${t.commentary}`);const n=T(e,t.score);y(6,`⏳ Pausing ${n} seconds before next phrase`),await new Promise(e=>setTimeout(e,1e3*n))}}catch(e){s(7,l="Smeg! Something went wrong with the AI. Try again."),L();break}}}()}catch(e){y(2,"❌ Failed to start learning session:",e),s(7,l="Couldn't access your microphone. Please check your permissions and try again."),s(5,a=!1)}else s(7,l="Blimey! Something's gone wrong with the initialisation.")}function T(e,t){if(!e||!e.recentResults||0===e.recentResults.length)return p.pauseBetweenTests;return e.recentResults.filter(e=>1===e).length/e.recentResults.length<.25||t<4?p.pauseWhenStruggling:p.pauseBetweenTests}function L(){s(5,a=!1),u&&u.isSessionActive()&&(y(5,"🎓 Stopping persistent microphone session"),u.stopLearningSession()),l.includes("Score:")||l.includes("commentary")||s(7,l="Learning session stopped. Ready when you are!"),s(6,r=null)}b=async()=>{y(4,"🚀 App mounted, loading settings..."),ee.load(),await new Promise(e=>setTimeout(e,0)),await async function(){await w(),v()}(),d=!0,y(4,"🎉 App initialization complete")},x().$$.on_mount.push(b),function(e){x().$$.on_destroy.push(e)}(()=>{y(4,"🧹 App being destroyed, cleaning up..."),a&&L(),u&&u.destroy()});let k=null;return e.$$.update=()=>{8&e.$$.dirty[0]&&s(10,n=f[p.nativeLanguage]||[]),12&e.$$.dirty[0]&&s(9,o=Object.values(p.enabledCategories).some(e=>e)&&g.length>0),10&e.$$.dirty[0]&&u&&void 0!==p.loggingVerbosity&&u.options&&u.updateOptions({loggingVerbosity:p.loggingVerbosity}),9&e.$$.dirty[0]&&c&&void 0!==p.loggingVerbosity&&c.options&&c.updateOptions({loggingVerbosity:p.loggingVerbosity}),9&e.$$.dirty[0]&&c&&void 0!==p.repetitivenessFactor&&c.options&&c.updateOptions({repetitivenessFactor:p.repetitivenessFactor}),9&e.$$.dirty[0]&&c&&void 0!==p.passThreshold&&c.options&&c.updateOptions({passThreshold:p.passThreshold})},[c,u,g,p,i,a,r,l,h,o,n,m,function(e){const{category:t,enabled:s}=e.detail;c&&(c.setCategory(t,s),$())},function(e){const{action:t}=e.detail;if(!c)return void y(3,"❌ Debug test failed: no learning queue");const n=c.getNextTest();if(!n)return void y(3,"❌ Debug test failed: no phrases available");const o="pass"===t?10:0;y(5,`🐛 Debug ${t}: "${n.source}" → "${n.target}" (score: ${o})`),c.scoreCurrentTest(o),$(),s(7,l=`Debug ${t}: "${n.source}" scored ${o}/10`)},$,function(){a?L():S()},function(){s(4,i=!i)},function(){k=setTimeout(()=>{ee.updateSetting("showDeveloperSettings",!p.showDeveloperSettings),y(3,"🥚 Developer settings easter egg triggered!",p.showDeveloperSettings?"Enabled":"Disabled");const e=document.querySelector(".settings-toggle");e&&(e.style.transform="scale(0.95)",setTimeout(()=>e.style.transform="",150))},2e3)},function(){k&&(clearTimeout(k),k=null)},function(){k&&(clearTimeout(k),k=null)},function(){if(u&&confirm("Are you sure you want to clear the TTS cache? This will remove all cached audio.")){const e=u.clearTTSCache();s(7,l=e?"TTS cache cleared successfully!":"Failed to clear TTS cache."),setTimeout(()=>{a||s(7,l="Ready to start learning!")},3e3)}},function(){if(c&&confirm("Are you sure you want to reset the learning queue? This will clear all progress and start fresh.")){c.reset();const e=c.getCategories();s(2,g=e);const t={};e.forEach(e=>{t[e]=!0,c.setCategory(e,!0)}),ee.updateSetting("enabledCategories",t),$(),s(7,l="Learning queue reset successfully!"),setTimeout(()=>{a||s(7,l="Ready to start learning!")},3e3)}},function(t){e.$$.not_equal(p.showExpectedOutput,t)&&(p.showExpectedOutput=t,s(3,p))},function(t){e.$$.not_equal(p.showCategory,t)&&(p.showCategory=t,s(3,p))},function(t){e.$$.not_equal(p.showFeedback,t)&&(p.showFeedback=t,s(3,p))},function(t){e.$$.not_equal(p.showUpcomingQueue,t)&&(p.showUpcomingQueue=t,s(3,p))},function(t){e.$$.not_equal(p.enableAudioHints,t)&&(p.enableAudioHints=t,s(3,p))},function(t){e.$$.not_equal(p.translationThreshold,t)&&(p.translationThreshold=t,s(3,p))},function(t){e.$$.not_equal(p.pauseBetweenTests,t)&&(p.pauseBetweenTests=t,s(3,p))},function(t){e.$$.not_equal(p.pauseWhenStruggling,t)&&(p.pauseWhenStruggling=t,s(3,p))},function(t){e.$$.not_equal(p.passThreshold,t)&&(p.passThreshold=t,s(3,p))},function(t){e.$$.not_equal(p.repetitivenessFactor,t)&&(p.repetitivenessFactor=t,s(3,p))},function(t){e.$$.not_equal(p.enabledCategories,t)&&(p.enabledCategories=t,s(3,p))},function(t){e.$$.not_equal(p.loggingVerbosity,t)&&(p.loggingVerbosity=t,s(3,p))}]}return new class extends z{constructor(e){super(),J(this,e,Ye,Ge,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
