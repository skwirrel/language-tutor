var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function s(e){e.forEach(t)}function o(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(t){return t&&o(t.destroy)?t.destroy:e}function r(e,t){e.appendChild(t)}function l(e,t,n){e.insertBefore(t,n||null)}function c(e){e.parentNode&&e.parentNode.removeChild(e)}function u(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function g(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function d(){return h(" ")}function p(){return h("")}function f(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function m(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function y(e){return""===e?null:+e}function b(e,t){t=""+t,e.data!==t&&(e.data=t)}function w(e,t){e.value=null==t?"":t}function v(e,t,n){for(let n=0;n<e.options.length;n+=1){const s=e.options[n];if(s.__value===t)return void(s.selected=!0)}n&&void 0===t||(e.selectedIndex=-1)}function $(e){const t=e.querySelector(":checked");return t&&t.__value}function S(e,t,n){e.classList[n?"add":"remove"](t)}let T;function x(e){T=e}function k(){if(!T)throw new Error("Function called outside component initialization");return T}function L(){const e=k();return(t,n,{cancelable:s=!1}={})=>{const o=e.$$.callbacks[t];if(o){const i=function(e,t,{bubbles:n=!1,cancelable:s=!1}={}){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,s,t),o}(t,n,{cancelable:s});return o.slice().forEach(t=>{t.call(e,i)}),!i.defaultPrevented}return!0}}const C=[],E=[];let R=[];const _=[],A=Promise.resolve();let P=!1;function F(e){R.push(e)}function D(e){_.push(e)}const O=new Set;let q=0;function N(){if(0!==q)return;const e=T;do{try{for(;q<C.length;){const e=C[q];q++,x(e),I(e.$$)}}catch(e){throw C.length=0,q=0,e}for(x(null),C.length=0,q=0;E.length;)E.pop()();for(let e=0;e<R.length;e+=1){const t=R[e];O.has(t)||(O.add(t),t())}R.length=0}while(C.length);for(;_.length;)_.pop()();P=!1,O.clear(),x(e)}function I(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(F)}}const Q=new Set;let H;function V(e,t){e&&e.i&&(Q.delete(e),e.i(t))}function M(e,t,n,s){if(e&&e.o){if(Q.has(e))return;Q.add(e),H.c.push(()=>{Q.delete(e),s&&(n&&e.d(1),s())}),e.o(t)}else s&&s()}function B(e,t,n){const s=e.$$.props[t];void 0!==s&&(e.$$.bound[s]=n,n(e.$$.ctx[s]))}function U(e){e&&e.c()}function W(e,n,i,a){const{fragment:r,after_update:l}=e.$$;r&&r.m(n,i),a||F(()=>{const n=e.$$.on_mount.map(t).filter(o);e.$$.on_destroy?e.$$.on_destroy.push(...n):s(n),e.$$.on_mount=[]}),l.forEach(F)}function K(e,t){const n=e.$$;null!==n.fragment&&(!function(e){const t=[],n=[];R.forEach(s=>-1===e.indexOf(s)?t.push(s):n.push(s)),n.forEach(e=>e()),R=t}(n.after_update),s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function j(e,t){-1===e.$$.dirty[0]&&(C.push(e),P||(P=!0,A.then(N)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function z(t,o,i,a,r,l,u,g=[-1]){const h=T;x(t);const d=t.$$={fragment:null,ctx:[],props:l,update:e,not_equal:r,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(h?h.$$.context:[])),callbacks:n(),dirty:g,skip_bound:!1,root:o.target||h.$$.root};u&&u(d.root);let p=!1;if(d.ctx=i?i(t,o.props||{},(e,n,...s)=>{const o=s.length?s[0]:n;return d.ctx&&r(d.ctx[e],d.ctx[e]=o)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](o),p&&j(t,e)),n}):[],d.update(),p=!0,s(d.before_update),d.fragment=!!a&&a(d.ctx),o.target){if(o.hydrate){const e=function(e){return Array.from(e.childNodes)}(o.target);d.fragment&&d.fragment.l(e),e.forEach(c)}else d.fragment&&d.fragment.c();o.intro&&V(t.$$.fragment),W(t,o.target,o.anchor,o.customElement),N()}x(h)}class J{$destroy(){K(this,1),this.$destroy=e}$on(t,n){if(!o(n))return e;const s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(n),()=>{const e=s.indexOf(n);-1!==e&&s.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class G{constructor(e,t,n="basic",s="/learning/",o={}){this.sourceLanguage=e,this.targetLanguage=t,this.baseDir=s,this.level=n,this.testDatabase={},this.queue=[],this.categories={},this.currentTestIndex=0,this.storageKey=`learning_queue_${e}_${t}_${n}`,this.options={passThreshold:7,memoryLength:20,repetitivenessFactor:5,...o}}async init(){await this.loadTestData(),this.loadState()}async loadTestData(){try{const e=`${this.sourceLanguage}-${this.targetLanguage}-${this.level}.json`,t=await fetch(`${this.baseDir}${e}`);if(!t.ok)throw new Error(`Failed to load test data: ${t.status}`);this.testDatabase=await t.json()}catch(e){console.error("Error loading test data:",e),this.testDatabase={travel:[{source:"Good morning",target:"Buongiorno"},{source:"Where is the station?",target:"Dove √® la stazione?"},{source:"Thank you very much",target:"Grazie mille"}],food:[{source:"I would like a coffee",target:"Vorrei un caff√®"},{source:"How much does it cost?",target:"Quanto costa?"},{source:"The bill please",target:"Il conto per favore"}]}}}loadState(){const e=localStorage.getItem(this.storageKey);if(e)try{const t=JSON.parse(e);this.categories=t.categories||{},this.queue=t.queue||[],this.syncQueueWithDatabase()}catch(e){console.error("Error loading saved state:",e),this.initializeAllCategories()}else this.initializeAllCategories()}syncQueueWithDatabase(){const e=new Set;for(const[t,n]of Object.entries(this.categories))n&&this.testDatabase[t]&&this.testDatabase[t].forEach(t=>{e.add(this.createTestId(t))});this.queue=this.queue.filter(t=>{const n=this.createTestId({source:t.source,target:t.target});return e.has(n)});const t=new Set(this.queue.map(e=>this.createTestId({source:e.source,target:e.target})));for(const[e,n]of Object.entries(this.categories))n&&this.testDatabase[e]&&this.testDatabase[e].forEach(n=>{const s=this.createTestId(n);t.has(s)||this.addTestToQueue(n,e)})}initializeAllCategories(){for(const e of Object.keys(this.testDatabase))this.categories[e]=!1}createTestId(e){return`${e.source}|${e.target}`}addTestToQueue(e,t){const n={source:e.source,target:e.target,inertia:-1,category:t,recentResults:new Array(this.options.memoryLength).fill(0)},s=Math.floor(Math.random()*(this.queue.length+1));this.queue.splice(s,0,n)}addCategoryToQueue(e){this.testDatabase[e]&&this.testDatabase[e].forEach(t=>{this.addTestToQueue(t,e)})}removeCategoryFromQueue(e){if(!this.testDatabase[e])return;const t=new Set(this.testDatabase[e].map(e=>this.createTestId(e)));this.queue=this.queue.filter(e=>{const n=this.createTestId({source:e.source,target:e.target});return!t.has(n)}),this.currentTestIndex>=this.queue.length&&(this.currentTestIndex=0)}getCategories(){return Object.keys(this.testDatabase)}setCategory(e,t){t&&!this.categories[e]?(this.categories[e]=!0,this.addCategoryToQueue(e)):!t&&this.categories[e]&&(this.categories[e]=!1,this.removeCategoryFromQueue(e)),this.saveState()}getNextTest(){if(0===this.queue.length)return null;this.currentTestIndex>=this.queue.length&&(this.currentTestIndex=0);const e=this.queue[this.currentTestIndex];return{source:e.source,target:e.target,inertia:e.inertia,category:e.category,recentResults:e.recentResults||[]}}scoreCurrentTest(e){if(0===this.queue.length||this.currentTestIndex>=this.queue.length)return;const t=this.queue.splice(this.currentTestIndex,1)[0];t.recentResults||(t.recentResults=[]);const n=e>=this.options.passThreshold;if(t.recentResults.push(n?1:0),!n)for(let e=t.recentResults.length-2;e>=0;e--)if(1===t.recentResults[e]){t.recentResults[e]=0;break}const s=this.options.memoryLength;t.recentResults.length>s&&(t.recentResults=t.recentResults.slice(-s));const o=t.recentResults.reduce((e,t)=>e+t,0),i=t.recentResults.length>0?o/t.recentResults.length:0,a=2+.2*(this.options.repetitivenessFactor-1),r=Math.pow(i,a),l=Math.min(Math.floor(r*this.queue.length),this.queue.length);this.queue.splice(l,0,t),this.currentTestIndex=0,this.saveState()}updateOptions(e){this.options={...this.options,...e}}saveState(){const e={categories:this.categories,queue:this.queue};try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.error("Error saving state to localStorage:",e)}}getQueueLength(){return this.queue.length}getTopQueueItems(e=null){const t=e?Math.min(e,this.queue.length):this.queue.length;return this.queue.slice(0,t).map((e,t)=>{const n=e.recentResults?e.recentResults.reduce((e,t)=>e+t,0):0,s=e.recentResults&&e.recentResults.length>0?n/e.recentResults.length:0;return{position:t+1,source:e.source,target:e.target,inertia:e.inertia,category:e.category,recentResults:e.recentResults||[],successRate:s}})}reset(){console.log("üîÑ Resetting LearningQueue to initial state"),this.queue=[],this.categories={},this.currentTestIndex=0,localStorage.removeItem(this.storageKey),this.initializeAllCategories(),console.log("‚úÖ LearningQueue reset complete")}getQueueStats(){const e={totalItems:this.queue.length,categories:{},inertiaDistribution:{negative:0,neutral:0,positive:0}};return this.queue.forEach(t=>{e.categories[t.category]||(e.categories[t.category]=0),e.categories[t.category]++;const n=t.recentResults?t.recentResults.reduce((e,t)=>e+t,0):0,s=t.recentResults&&t.recentResults.length>0?n/t.recentResults.length:0;s<.3?e.inertiaDistribution.negative++:s>.7?e.inertiaDistribution.positive++:e.inertiaDistribution.neutral++}),e}}class Y{constructor(e,t="English",n="Italian",s={}){this.outputElement=e,this.sourceLanguage=t,this.targetLanguage=n;this.options=this.mergeOptions({apiKeyEndpoint:"?mode=get_key",feedbackThreshold:7,statusCallback:null,loggingVerbosity:5,audioPath:"audio/",enableBleep:!0,enableAudioHints:!1,audioHintDuration:.25,audioHintMinWords:3,vad:{threshold:.6,prefixPaddingMs:200,silenceDurationMs:800}},s),this.audioContext=null,this.currentAudioStream=null,this.audioProcessor=null,this.ws=null,this.isListening=!1,this.currentSessionKey=null,this.keyRefreshInterval=null,this.log(3,`üéì LanguageTutor initialized: ${t} ‚Üí ${n}`),this.log(7,"üìã Options:",this.options),this.initializeSessionKeys()}log(e,...t){this.options.loggingVerbosity>=e&&console.log(...t)}logError(e,...t){this.options.loggingVerbosity>=e&&console.error(...t)}logWarn(e,...t){this.options.loggingVerbosity>=e&&console.warn(...t)}mergeOptions(e,t){const n={...e};for(const s in t)t.hasOwnProperty(s)&&("object"!=typeof t[s]||null===t[s]||Array.isArray(t[s])?n[s]=t[s]:n[s]={...e[s],...t[s]});return n}async playNotificationBleep(){if(this.options.enableBleep)try{this.log(6,"üéµ Playing notification bleep");const e=new(window.AudioContext||window.webkitAudioContext),t=.3,n=e.sampleRate,s=e.createBuffer(1,t*n,n),o=s.getChannelData(0);for(let e=0;e<s.length;e++){const t=e/n;let s,i;t<.15?(s=800,i=.1*Math.sin(Math.PI*t/.15)):(s=1e3,i=.1*Math.sin(Math.PI*(t-.15)/.15)),o[e]=i*Math.sin(2*Math.PI*s*t)}const i=e.createBufferSource();return i.buffer=s,i.connect(e.destination),new Promise(t=>{i.onended=()=>{e.close(),this.log(7,"‚úÖ Notification bleep completed"),t()},i.start()})}catch(e){this.logWarn(4,"‚ö†Ô∏è Could not play notification bleep:",e.message)}else this.log(7,"üîá Notification bleep disabled")}async initializeSessionKeys(){try{await this.refreshSessionKey(),this.startKeyRefreshTimer()}catch(e){this.logError(1,"‚ùå Failed to initialize session keys:",e)}}async refreshSessionKey(){try{this.log(5,"üîë Refreshing session key...");const e=await fetch(this.options.apiKeyEndpoint);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(t.error)throw new Error(t.error);return this.currentSessionKey=t.session_token,this.log(4,"‚úÖ Session key refreshed successfully"),this.currentSessionKey}catch(e){return this.logError(2,"‚ùå Error refreshing session key:",e),this.showError("Failed to refresh session key: "+e.message),null}}async getSessionKey(){return this.currentSessionKey?(this.log(7,"üîë Using cached session key"),this.currentSessionKey):(this.log(5,"üîë Getting initial session key..."),await this.refreshSessionKey())}startKeyRefreshTimer(){this.keyRefreshInterval=setInterval(async()=>{await this.refreshSessionKey()},5e4),this.log(6,"‚è∞ Started key refresh timer (every 50 seconds)")}stopKeyRefreshTimer(){this.keyRefreshInterval&&(clearInterval(this.keyRefreshInterval),this.keyRefreshInterval=null,this.log(6,"‚è∞ Stopped key refresh timer"))}async speakText(e,t=null){return new Promise(async(n,s)=>{try{t||(t=this.detectLanguage(e)),this.log(4,`üéôÔ∏è Playing audio for "${e}" in ${t}`);const s=t===this.sourceLanguage,o=s?"native":"learning";this.log(6,`üéØ Speed mode: ${o} (${s?"normal speed":"slow/clear"})`);const i=await this.generateAudioFilename(e),a=`${this.options.audioPath}${t}/${o}/${i}`;this.log(6,`üîä Loading audio from: ${a}`),await this.playAudioFromUrl(a),n()}catch(e){this.logError(3,"‚ùå Error playing audio:",e),this.showError("Audio playback failed: "+e.message),s(e)}})}async generateAudioFilename(e){const t=this.stringToUtf8Bytes(e).slice(0,20);let n="";for(let e=0;e<t.length;e++){const s=t[e],o=String.fromCharCode(s);/[a-zA-Z0-9]/.test(o)?n+=o:n+="_"}n=n.replace(/_+$/,""),n||(n="phrase");return`${n}_${(await this.sha256(e)).substring(0,8)}.mp3`}async sha256(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join("")}stringToUtf8Bytes(e){const t=[];for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t.push(s):s<2048?(t.push(192|s>>6),t.push(128|63&s)):s<65536?(t.push(224|s>>12),t.push(128|s>>6&63),t.push(128|63&s)):(t.push(240|s>>18),t.push(128|s>>12&63),t.push(128|s>>6&63),t.push(128|63&s))}return t}async playAudioFromUrl(e){return new Promise((t,n)=>{try{this.log(6,"üîä Creating audio element for playback");const s=new Audio;s.onloadeddata=()=>{this.log(7,"‚úÖ Audio loaded successfully")},s.onended=()=>{this.log(6,"‚úÖ Audio playback finished"),t()},s.onerror=t=>{this.logError(3,"‚ùå Audio playback error:",t),n(new Error(`Failed to load audio from ${e}`))},s.oncanplaythrough=()=>{this.log(7,"‚ñ∂Ô∏è Starting audio playback"),s.play().catch(e=>{this.logError(3,"‚ùå Audio play() failed:",e),n(e)})},s.src=e,s.load()}catch(e){this.logError(3,"‚ùå Error setting up audio playback:",e),n(e)}})}async playAudioHint(e,t=null,n="learning"){return new Promise(async(s,o)=>{try{t||(t=this.targetLanguage),this.log(5,`üéØ Playing audio hint for: "${e}" in ${t}`);const i=await this.generateAudioFilename(e),a=`${this.options.audioPath}${t}/${n}/${i}`;this.log(6,`üîä Loading hint audio from: ${a}`);const r=new Audio;r.onloadedmetadata=()=>{this.log(7,`‚úÖ Audio metadata loaded, duration: ${r.duration}s`);const e=r.duration*this.options.audioHintDuration;this.log(7,`üéØ Playing first ${e.toFixed(2)}s as hint (${100*this.options.audioHintDuration}% of ${r.duration.toFixed(2)}s)`);const t=setTimeout(()=>{r.pause(),r.currentTime=0,this.log(7,"üîá Hint playback completed"),s()},1e3*e);r.onended=()=>{clearTimeout(t),this.log(7,"üîá Audio hint ended naturally"),s()},r.play().catch(e=>{clearTimeout(t),this.logError(3,"‚ùå Audio hint play() failed:",e),o(e)})},r.onerror=e=>{this.logError(3,"‚ùå Audio hint error:",e),o(new Error(`Failed to load audio hint from ${a}`))},r.src=a,r.load()}catch(e){this.logError(3,"‚ùå Error setting up audio hint:",e),o(e)}})}shouldPlayHint(e,t){if(!t||0===t.length)return this.log(8,"üéØ No hint: no recent results"),!1;const n=e.trim().split(/\s+/).length;if(n<this.options.audioHintMinWords)return this.log(8,`üéØ No hint: phrase too short (${n} words < ${this.options.audioHintMinWords} minimum)`),!1;const s=t.filter(e=>1===e).length,o=s/t.length;this.log(8,`üéØ Hint check: ${s}/${t.length} success rate: ${o.toFixed(2)}, words: ${n}`,t);const i=s>0&&o<.5;return this.log(8,`üéØ Should play hint: ${i}`),i}async startRecording(){try{const e=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:24e3,channelCount:1,echoCancellation:!0,noiseSuppression:!0}});this.currentAudioStream=e,this.audioContext=new AudioContext({sampleRate:24e3});const t=this.audioContext.createMediaStreamSource(e);this.audioProcessor=this.audioContext.createScriptProcessor(1024,1,1),this.audioProcessor.onaudioprocess=e=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN&&this.isListening){const t=e.inputBuffer.getChannelData(0),n=new Int16Array(t.length);for(let e=0;e<t.length;e++)n[e]=Math.max(-32768,Math.min(32767,32768*t[e]));const s=new Uint8Array(n.buffer),o=btoa(String.fromCharCode.apply(null,s));this.ws.send(JSON.stringify({type:"input_audio_buffer.append",audio:o}))}},t.connect(this.audioProcessor),this.audioProcessor.connect(this.audioContext.destination),this.isListening=!0,this.log(5,"üé§ Started recording and listening")}catch(e){throw this.logError(2,"Error starting recording:",e),this.showError("Could not access microphone: "+e.message),e}}pauseListening(){this.isListening=!1,this.log(6,"‚è∏Ô∏è Paused listening (microphone still active)")}resumeListening(){this.isListening=!0,this.log(6,"‚ñ∂Ô∏è Resumed listening")}stopRecording(){this.isListening=!1,this.currentAudioStream&&(this.currentAudioStream.getTracks().forEach(e=>e.stop()),this.currentAudioStream=null),this.audioProcessor&&(this.audioProcessor.disconnect(),this.audioProcessor=null),this.audioContext&&"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null),this.log(5,"üõë Stopped recording completely")}detectLanguage(e){const t=["the","a","an","is","are","was","were","and","or","but","in","on","at","to","for","of","with","by"],n=e.toLowerCase().split(/\s+/);return n.filter(e=>t.includes(e)).length/n.length>.2?this.sourceLanguage:this.targetLanguage}showStatus(e){this.log(7,"üì¢ Status:",e),this.options.statusCallback&&this.options.statusCallback(e),this.outputElement&&(this.outputElement.textContent=e)}showError(e){this.logError(2,"‚ùå Error:",e),this.outputElement&&(this.outputElement.textContent="Error: "+e,this.outputElement.style.color="red",setTimeout(()=>{this.outputElement.style.color=""},3e3))}showScore(e){return this.log(4,"üìä Score:",e),{score:e,message:this.getScoreMessage(e),emoji:this.getScoreEmoji(e)}}getScoreMessage(e){return e>=8?"Excellent work!":e>=6?"Good job!":"Keep practicing!"}getScoreEmoji(e){return e>=8?"üéâ":e>=6?"üëç":"üìö"}updateOptions(e){return this.log(5,"üîß Updating tutor options:",e),this.options=this.mergeOptions(this.options,e),this.log(6,"‚úÖ Options updated:",this.options),this.options}getOptions(){return{...this.options}}clearTTSCache(){try{return localStorage.removeItem("tts_audio_cache"),this.log(4,"üóëÔ∏è Legacy TTS cache cleared successfully"),!0}catch(e){return this.logError(3,"‚ùå Error clearing legacy TTS cache:",e),!1}}getTTSCacheSize(){return{entries:0,chunks:0,sizeBytes:0,sizeMB:0,note:"Using server-side audio files - no client cache needed"}}async test(e,t,n=[],s=10){try{this.showStatus("Getting session key...");const o=await this.getSessionKey();return o?(this.showStatus("Connecting to ChatGPT..."),this.log(4,"üîó Creating new ChatGPT WebSocket connection for testing"),this.log(6,"üéöÔ∏è Using VAD settings:",this.options.vad),this.log(6,"üéØ Feedback threshold:",this.options.feedbackThreshold),this.ws=new WebSocket("wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-10-01&openai-beta=realtime%3Dv1",["realtime",`openai-insecure-api-key.${o}`,"openai-beta.realtime-v1"]),new Promise(o=>{let i,a=!1;this.ws.onopen=async()=>{this.log(5,"‚úÖ Connected to ChatGPT Realtime API");const r=`You are a language learning tutor. The user will attempt to translate "${e}" from ${this.sourceLanguage} into ${this.targetLanguage}. Your job is to:\n\n1. Listen to their pronunciation and translation attempt in ${this.targetLanguage}\n2. Rate their overall performance from 1-10 (1=can't translate, 4=most words correct, but some missing, 6=words correct, but pronunciation is poor, 8=Right words, OK pronunciation, 10=perfect!) considering both:\n   - Translation accuracy (did they get the meaning right?)\n   - Pronunciation quality (does it sound like proper ${this.targetLanguage}?)\n3. Special cases:\n   - If they say "I don't know", "I give up", "skip", "pass", or similar phrases in ${this.sourceLanguage}, give them a score of 1 and provide encouraging feedback\n   - If they say "again", "play it again", "repeat", "one more time", or similar in any language, give them a score of 0 with commentary explaining they'll hear it again\n   - If they say "stop", "pause", "that's enough", "quit", "finish", "done" or similar in any language, respond with {"score": 0, "commentary": "User requested to stop", "stop": true}\n   - If they remain completely silent, score them 0 with appropriate commentary\n4. Provide specific, helpful commentary on their attempt including:\n   - Specific tips for better ${this.targetLanguage} pronunciation\n   - For "I don't know" responses, provide the correct answer and encouragement\n   - For "again" requests, acknowledge they'll hear the phrase repeated\n\nRespond with a JSON object in this exact format:\n{\n    "score": [0-10],\n    "commentary": "Detailed feedback on their pronunciation and translation accuracy, including specific suggestions for improvement",\n    "stop": false\n}\n\nIMPORTANT: Your response must be valid JSON only. Do not include any text outside the JSON object.`;this.options.loggingVerbosity>=8&&(this.log(8,"üì§ Sending prompt to ChatGPT:"),this.log(8,"------- PROMPT START -------"),this.log(8,r),this.log(8,"------- PROMPT END -------")),this.ws.send(JSON.stringify({type:"session.update",session:{modalities:["text"],instructions:r,input_audio_format:"pcm16",input_audio_transcription:{model:"whisper-1"},turn_detection:{type:"server_vad",threshold:this.options.vad.threshold,prefix_padding_ms:this.options.vad.prefixPaddingMs,silence_duration_ms:this.options.vad.silenceDurationMs}}})),await this.startRecording();if(0===n.reduce((e,t)=>e+t,0))this.showStatus(`üéµ New phrase! Listen to this ${this.sourceLanguage} phrase...`),this.pauseListening(),await this.speakText(e,this.sourceLanguage),this.showStatus(`üéµ Now here's how to say it in ${this.targetLanguage}...`),await this.speakText(t,this.targetLanguage),await new Promise(e=>setTimeout(e,1e3)),await this.speakText(t,this.targetLanguage),this.showStatus(`üé§ Now you try! Say it in ${this.targetLanguage}...`),await this.playNotificationBleep(),this.resumeListening();else{if(this.showStatus(`üéµ Listen to this ${this.sourceLanguage} phrase...`),this.pauseListening(),await this.speakText(e,this.sourceLanguage),this.options.enableAudioHints&&this.shouldPlayHint(t,n))try{this.showStatus("üéØ Here is a hint for you..."),this.log(6,"üéØ Playing audio hint for struggling phrase"),await this.playAudioHint(t),await new Promise(e=>setTimeout(e,500))}catch(e){this.log(4,"‚ö†Ô∏è Audio hint failed:",e)}this.showStatus(`üé§ Now say it in ${this.targetLanguage}...`),await this.playNotificationBleep(),this.resumeListening()}i=setTimeout(()=>{a||(this.log(4,"‚è∞ Silence timeout reached"),this.cleanup(),o({score:0,commentary:"No response detected within the time limit. Please try speaking closer to the microphone or check your audio settings.",stop:!1}))},1e3*s)},this.ws.onmessage=async e=>{const n=JSON.parse(e.data);if(this.log(8,"üì® Received message:",n.type),["response.done","error","response.text.delta"].includes(n.type)&&this.log(9,"üìã Full message details:",n),"session.updated"===n.type&&this.log(6,"‚úÖ Session configured successfully"),"input_audio_buffer.speech_started"===n.type&&(this.log(6,"üé§ Speech detected, user started speaking"),clearTimeout(i)),"input_audio_buffer.speech_stopped"===n.type&&this.log(6,"üîá Speech stopped, processing..."),"response.done"===n.type){this.log(5,"‚úÖ Response complete from ChatGPT"),a=!0,clearTimeout(i);const e=n.response;let s={score:0,commentary:"Unable to process response",stop:!1};if(this.log(6,"üîç Processing ChatGPT response..."),this.log(9,"üì• Raw response object:",JSON.stringify(e,null,2)),e.output&&e.output.length>0){for(const t of e.output)if(this.log(8,"üìÑ Processing output item:",t),t.content&&t.content.length>0)for(const e of t.content)if("text"===e.type&&e.text){this.options.loggingVerbosity>=7&&(this.log(7,"üì• Raw ChatGPT response text:"),this.log(7,"------- RESPONSE START -------"),this.log(7,e.text),this.log(7,"------- RESPONSE END -------"));try{const t=JSON.parse(e.text);this.log(6,"‚úÖ Successfully parsed JSON response:",t),s={score:parseInt(t.score)||0,commentary:t.commentary||"No commentary provided",stop:Boolean(t.stop)},this.log(5,"üìä Processed result:",s)}catch(t){this.logWarn(4,"‚ùå Failed to parse JSON response, attempting fallback parsing"),this.logWarn(6,"Parse error:",t.message);const n=e.text.match(/score["\s]*:["\s]*(\d+)/i),o=e.text.toLowerCase().includes("stop")||e.text.toLowerCase().includes("pause")||e.text.toLowerCase().includes("enough");s={score:n?parseInt(n[1]):0,commentary:e.text,stop:o},this.log(5,"üîß Fallback parsed result:",s)}}}else this.logWarn(3,"‚ö†Ô∏è No output found in ChatGPT response");if(s.stop)return this.log(4,"üõë User requested to stop"),this.cleanup(),void o(s);this.showStatus("Test complete!");this.showScore(s.score);if(s.score>0&&s.score<=this.options.feedbackThreshold){this.log(5,`üì¢ Score ${s.score} below threshold ${this.options.feedbackThreshold}, speaking ${this.targetLanguage} target phrase...`);const e=this.isListening;if(e&&this.pauseListening(),s.score<3){this.log(4,`üîÅ Score ${s.score} is very low, repeating target phrase 3 times for better learning`),this.showStatus(`üéµ Score ${s.score}/10 - Here's the ${this.targetLanguage} pronunciation (3 times)...`);for(let e=1;e<=3;e++)this.log(6,`üéµ Playing repetition ${e}/3`),await this.speakText(t,this.targetLanguage),e<3&&await new Promise(e=>setTimeout(e,800))}else this.showStatus(`üéµ Here's the ${this.targetLanguage} pronunciation...`),await this.speakText(t,this.targetLanguage);e&&this.resumeListening()}this.log(4,"üìä Final result returned:",s),this.cleanup(),o(s)}"error"===n.type&&(this.logError(2,"‚ùå ChatGPT WebSocket error:",n.error),this.log(8,"üí• Full error details:",JSON.stringify(n,null,2)),this.showError("Error: "+n.error.message),this.cleanup(),o({score:0,commentary:`Error occurred: ${n.error.message}`,stop:!1}))},this.ws.onerror=e=>{this.logError(2,"‚ùå WebSocket connection error:",e),this.showError("Connection error occurred"),this.cleanup(),o({score:0,commentary:"Connection error occurred. Please check your internet connection and try again.",stop:!1})}})):{score:0,commentary:"Failed to get session key",stop:!1}}catch(e){return this.logError(1,"üí• Error in test method:",e),this.log(8,"üîç Error stack trace:",e.stack),this.showError("Error: "+e.message),{score:0,commentary:`Error occurred: ${e.message}`,stop:!1}}}cleanup(){this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.log(5,"üîå Closing ChatGPT WebSocket connection"),this.ws.close(),this.ws=null),this.stopRecording()}destroy(){this.log(4,"üßπ Destroying LanguageTutor instance"),this.cleanup(),this.stopKeyRefreshTimer()}}const Z=[];const X={nativeLanguage:"English",learningLanguage:"Italian",showExpectedOutput:"always",showCategory:!0,showFeedback:!0,showUpcomingQueue:!1,enableAudioHints:!1,translationThreshold:7,pauseBetweenTests:3,pauseWhenStruggling:5,passThreshold:7,repetitivenessFactor:5,loggingVerbosity:5,showDeveloperSettings:!1,enabledCategories:{}};const ee=function(){const{subscribe:t,set:n,update:s}=function(t,n=e){let s;const o=new Set;function a(e){if(i(t,e)&&(t=e,s)){const e=!Z.length;for(const e of o)e[1](),Z.push(e,t);if(e){for(let e=0;e<Z.length;e+=2)Z[e][0](Z[e+1]);Z.length=0}}}return{set:a,update:function(e){a(e(t))},subscribe:function(i,r=e){const l=[i,r];return o.add(l),1===o.size&&(s=n(a)||e),i(t),()=>{o.delete(l),0===o.size&&s&&(s(),s=null)}}}}(X);return{subscribe:t,load:()=>{if("undefined"==typeof localStorage)return;const e=localStorage.getItem("languageTutorSettings");if(e)try{const t=JSON.parse(e);s(e=>({...e,...t})),console.log("‚úÖ Settings loaded from localStorage")}catch(e){console.error("‚ùå Failed to parse saved settings:",e)}},save:e=>{if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(e)),console.log("üíæ Settings saved to localStorage")}catch(e){console.error("‚ùå Failed to save settings:",e)}},updateSetting:(e,t)=>{s(n=>{const s={...n,[e]:t};if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(s))}catch(e){console.error("‚ùå Failed to save setting:",e)}return s})},updateSettings:e=>{s(t=>{const n={...t,...e};if("undefined"!=typeof localStorage)try{localStorage.setItem("languageTutorSettings",JSON.stringify(n))}catch(e){console.error("‚ùå Failed to save settings:",e)}return n})},reset:()=>{n(X),"undefined"!=typeof localStorage&&localStorage.removeItem("languageTutorSettings")}}}();function te(e,t){function n(e){const n="checkbox"===e.target.type?e.target.checked:e.target.value;if(t&&"undefined"!=typeof localStorage)try{const e=localStorage.getItem("languageTutorSettings"),s=e?JSON.parse(e):{};s[t]=n,localStorage.setItem("languageTutorSettings",JSON.stringify(s)),console.log(`üíæ Saved ${t}:`,n)}catch(e){console.error(`Failed to save ${t}:`,e)}}return e.addEventListener("change",n),{destroy(){e.removeEventListener("change",n)}}}function ne(e,t,n){const s=e.slice();return s[9]=t[n],s}function se(e,t,n){const s=e.slice();return s[9]=t[n],s}function oe(e){let t,n,s,o,i=e[9]+"";return{c(){t=g("option"),n=h(i),s=d(),t.__value=o=e[9],t.value=t.__value},m(e,o){l(e,t,o),r(t,n),r(t,s)},p(e,s){4&s&&i!==(i=e[9]+"")&&b(n,i),4&s&&o!==(o=e[9])&&(t.__value=o,t.value=t.__value)},d(e){e&&c(t)}}}function ie(e){let t,n,s,o,i=e[9]+"";return{c(){t=g("option"),n=h(i),s=d(),t.__value=o=e[9],t.value=t.__value},m(e,o){l(e,t,o),r(t,n),r(t,s)},p(e,s){8&s&&i!==(i=e[9]+"")&&b(n,i),8&s&&o!==(o=e[9])&&(t.__value=o,t.value=t.__value)},d(e){e&&c(t)}}}function ae(t){let n,o,i,h,p,y,b,w,$,S,T,x,k,L,C=t[2],E=[];for(let e=0;e<C.length;e+=1)E[e]=oe(se(t,C,e));let R=t[3],_=[];for(let e=0;e<R.length;e+=1)_[e]=ie(ne(t,R,e));return{c(){n=g("h3"),n.textContent="Language Selection",o=d(),i=g("div"),h=g("div"),p=g("label"),p.textContent="Native Language",y=d(),b=g("select");for(let e=0;e<E.length;e+=1)E[e].c();w=d(),$=g("div"),S=g("label"),S.textContent="Learning Language",T=d(),x=g("select");for(let e=0;e<_.length;e+=1)_[e].c();m(n,"class","section-header"),m(p,"class","form-label"),m(b,"class","form-select"),void 0===t[0]&&F(()=>t[5].call(b)),m(h,"class","form-group"),m(S,"class","form-label"),m(x,"class","form-select"),void 0===t[1]&&F(()=>t[6].call(x)),m($,"class","form-group"),m(i,"class","language-grid")},m(e,s){l(e,n,s),l(e,o,s),l(e,i,s),r(i,h),r(h,p),r(h,y),r(h,b);for(let e=0;e<E.length;e+=1)E[e]&&E[e].m(b,null);v(b,t[0],!0),r(i,w),r(i,$),r($,S),r($,T),r($,x);for(let e=0;e<_.length;e+=1)_[e]&&_[e].m(x,null);v(x,t[1],!0),k||(L=[f(b,"change",t[5]),a(te.call(null,b,"nativeLanguage")),f(x,"change",t[6]),a(te.call(null,x,"learningLanguage"))],k=!0)},p(e,[t]){if(4&t){let n;for(C=e[2],n=0;n<C.length;n+=1){const s=se(e,C,n);E[n]?E[n].p(s,t):(E[n]=oe(s),E[n].c(),E[n].m(b,null))}for(;n<E.length;n+=1)E[n].d(1);E.length=C.length}if(5&t&&v(b,e[0]),8&t){let n;for(R=e[3],n=0;n<R.length;n+=1){const s=ne(e,R,n);_[n]?_[n].p(s,t):(_[n]=ie(s),_[n].c(),_[n].m(x,null))}for(;n<_.length;n+=1)_[n].d(1);_.length=R.length}10&t&&v(x,e[1])},i:e,o:e,d(e){e&&c(n),e&&c(o),e&&c(i),u(E,e),u(_,e),k=!1,s(L)}}}function re(e,t,n){let{nativeLanguage:s}=t,{learningLanguage:o}=t,{nativeLanguages:i}=t,{learningLanguages:a}=t,{loggingVerbosity:r=5}=t;return L(),e.$$set=e=>{"nativeLanguage"in e&&n(0,s=e.nativeLanguage),"learningLanguage"in e&&n(1,o=e.learningLanguage),"nativeLanguages"in e&&n(2,i=e.nativeLanguages),"learningLanguages"in e&&n(3,a=e.learningLanguages),"loggingVerbosity"in e&&n(4,r=e.loggingVerbosity)},[s,o,i,a,r,function(){s=$(this),n(0,s),n(2,i)},function(){o=$(this),n(1,o),n(3,a)}]}class le extends J{constructor(e){super(),z(this,e,re,ae,i,{nativeLanguage:0,learningLanguage:1,nativeLanguages:2,learningLanguages:3,loggingVerbosity:4})}}function ce(e){let t;return{c(){t=h("Expected translation shown only for phrases with success rate below 25%")},m(e,n){l(e,t,n)},d(e){e&&c(t)}}}function ue(e){let t;return{c(){t=h("Expected translation is never shown - test your memory!")},m(e,n){l(e,t,n)},d(e){e&&c(t)}}}function ge(e){let t;return{c(){t=h("Expected translation is always shown")},m(e,n){l(e,t,n)},d(e){e&&c(t)}}}function he(e){let t,n,o,i,u,p,y,v,$,S,T,x;return{c(){t=g("div"),n=g("label"),o=h("Pause When Struggling: "),i=h(e[7]),u=h("s\n      "),p=g("span"),p.textContent="Extra pause time for phrases with low success rate (<25%) or poor scores (<4)",y=d(),v=g("input"),$=d(),S=g("div"),S.innerHTML="<span>Quick (0.5s)</span> \n      <span>Default (5s)</span> \n      <span>Extended (15s)</span>",m(p,"class","threshold-description"),m(n,"class","form-label"),m(v,"type","range"),m(v,"min","0.5"),m(v,"max","15"),m(v,"step","0.5"),m(v,"class","threshold-slider"),m(S,"class","threshold-labels"),m(t,"class","threshold-setting")},m(s,c){l(s,t,c),r(t,n),r(n,o),r(n,i),r(n,u),r(n,p),r(t,y),r(t,v),w(v,e[7]),r(t,$),r(t,S),T||(x=[f(v,"change",e[16]),f(v,"input",e[16]),a(te.call(null,v,"pauseWhenStruggling"))],T=!0)},p(e,t){128&t&&b(i,e[7]),128&t&&w(v,e[7])},d(e){e&&c(t),T=!1,s(x)}}}function de(t){let n,o,i,u,p,y,$,S,T,x,k,L,C,E,R,_,A,P,D,O,q,N,I,Q,H,V,M,B,U,W,K,j,z,J,G,Y,Z,X,ee,ne,se,oe,ie,ae,re,le,de,pe,fe,me,ye,be,we,ve,$e,Se,Te,xe,ke,Le,Ce=0===t[5]?"Never repeat translation":10===t[5]?"Always repeat translation":`Repeat translation for scores below ${t[5]}`,Ee=t[6]<=1?"Quick - brief pause for score review":t[6]>=5?"Slow - plenty of time to read feedback":"Balanced - comfortable time to review your score";function Re(e,t){return"always"===e[0]?ge:"never"===e[0]?ue:"struggling"===e[0]?ce:void 0}let _e=Re(t),Ae=_e&&_e(t),Pe="struggling"===t[0]&&he(t);return{c(){n=g("h3"),n.textContent="Display Options",o=d(),i=g("div"),u=g("div"),p=g("label"),y=g("input"),$=d(),S=g("span"),S.textContent="Display Category",T=d(),x=g("label"),k=g("input"),L=d(),C=g("span"),C.textContent="Display Feedback",E=d(),R=g("label"),_=g("input"),A=d(),P=g("span"),P.textContent="Show Upcoming Queue",D=d(),O=g("label"),q=g("input"),N=d(),I=g("span"),I.textContent="Enable Audio Hints",Q=d(),H=g("div"),V=g("label"),V.textContent="Show Expected Translation",M=d(),B=g("select"),U=g("option"),U.textContent="Always",W=g("option"),W.textContent="Only when struggling",K=g("option"),K.textContent="Never",j=d(),z=g("p"),Ae&&Ae.c(),J=d(),G=g("div"),Y=g("label"),Z=h("Translation Repetition Threshold: "),X=h(t[5]),ee=d(),ne=g("span"),se=h(Ce),oe=d(),ie=g("input"),ae=d(),re=g("div"),re.innerHTML="<span>Never (0)</span> \n      <span>Default (7)</span> \n      <span>Always (10)</span>",le=d(),de=g("div"),pe=g("label"),fe=h("Pause Between Tests: "),me=h(t[6]),ye=h("s\n      "),be=g("span"),we=h(Ee),ve=d(),$e=g("input"),Se=d(),Te=g("div"),Te.innerHTML="<span>Quick (0.5s)</span> \n      <span>Default (3s)</span> \n      <span>Slow (10s)</span>",xe=d(),Pe&&Pe.c(),m(n,"class","section-header"),m(y,"type","checkbox"),m(y,"class","category-checkbox"),m(S,"class","category-label"),m(p,"class","category-item"),m(k,"type","checkbox"),m(k,"class","category-checkbox"),m(C,"class","category-label"),m(x,"class","category-item"),m(_,"type","checkbox"),m(_,"class","category-checkbox"),m(P,"class","category-label"),m(R,"class","category-item"),m(q,"type","checkbox"),m(q,"class","category-checkbox"),m(I,"class","category-label"),m(O,"class","category-item"),m(u,"class","display-options-list svelte-6s5pe4"),m(V,"class","form-label"),m(V,"for","expected-output-select"),U.__value="always",U.value=U.__value,W.__value="struggling",W.value=W.__value,K.__value="never",K.value=K.__value,m(B,"id","expected-output-select"),m(B,"class","form-select"),void 0===t[0]&&F(()=>t[13].call(B)),m(z,"class","setting-description"),m(H,"class","form-group expected-translation-section svelte-6s5pe4"),m(ne,"class","threshold-description"),m(Y,"class","form-label"),m(ie,"type","range"),m(ie,"min","0"),m(ie,"max","10"),m(ie,"step","1"),m(ie,"class","threshold-slider"),m(re,"class","threshold-labels"),m(G,"class","threshold-setting"),m(be,"class","threshold-description"),m(pe,"class","form-label"),m($e,"type","range"),m($e,"min","0.5"),m($e,"max","10"),m($e,"step","0.5"),m($e,"class","threshold-slider"),m(Te,"class","threshold-labels"),m(de,"class","threshold-setting"),m(i,"class","display-options-section")},m(e,s){l(e,n,s),l(e,o,s),l(e,i,s),r(i,u),r(u,p),r(p,y),y.checked=t[1],r(p,$),r(p,S),r(u,T),r(u,x),r(x,k),k.checked=t[2],r(x,L),r(x,C),r(u,E),r(u,R),r(R,_),_.checked=t[3],r(R,A),r(R,P),r(u,D),r(u,O),r(O,q),q.checked=t[4],r(O,N),r(O,I),r(i,Q),r(i,H),r(H,V),r(H,M),r(H,B),r(B,U),r(B,W),r(B,K),v(B,t[0],!0),r(H,j),r(H,z),Ae&&Ae.m(z,null),r(i,J),r(i,G),r(G,Y),r(Y,Z),r(Y,X),r(Y,ee),r(Y,ne),r(ne,se),r(G,oe),r(G,ie),w(ie,t[5]),r(G,ae),r(G,re),r(i,le),r(i,de),r(de,pe),r(pe,fe),r(pe,me),r(pe,ye),r(pe,be),r(be,we),r(de,ve),r(de,$e),w($e,t[6]),r(de,Se),r(de,Te),r(i,xe),Pe&&Pe.m(i,null),ke||(Le=[f(y,"change",t[9]),a(te.call(null,y,"showCategory")),f(k,"change",t[10]),a(te.call(null,k,"showFeedback")),f(_,"change",t[11]),f(_,"change",t[8]),a(te.call(null,_,"showUpcomingQueue")),f(q,"change",t[12]),a(te.call(null,q,"enableAudioHints")),f(B,"change",t[13]),a(te.call(null,B,"showExpectedOutput")),f(ie,"change",t[14]),f(ie,"input",t[14]),a(te.call(null,ie,"translationThreshold")),f($e,"change",t[15]),f($e,"input",t[15]),a(te.call(null,$e,"pauseBetweenTests"))],ke=!0)},p(e,[t]){2&t&&(y.checked=e[1]),4&t&&(k.checked=e[2]),8&t&&(_.checked=e[3]),16&t&&(q.checked=e[4]),1&t&&v(B,e[0]),_e!==(_e=Re(e))&&(Ae&&Ae.d(1),Ae=_e&&_e(e),Ae&&(Ae.c(),Ae.m(z,null))),32&t&&b(X,e[5]),32&t&&Ce!==(Ce=0===e[5]?"Never repeat translation":10===e[5]?"Always repeat translation":`Repeat translation for scores below ${e[5]}`)&&b(se,Ce),32&t&&w(ie,e[5]),64&t&&b(me,e[6]),64&t&&Ee!==(Ee=e[6]<=1?"Quick - brief pause for score review":e[6]>=5?"Slow - plenty of time to read feedback":"Balanced - comfortable time to review your score")&&b(we,Ee),64&t&&w($e,e[6]),"struggling"===e[0]?Pe?Pe.p(e,t):(Pe=he(e),Pe.c(),Pe.m(i,null)):Pe&&(Pe.d(1),Pe=null)},i:e,o:e,d(e){e&&c(n),e&&c(o),e&&c(i),Ae&&Ae.d(),Pe&&Pe.d(),ke=!1,s(Le)}}}function pe(e,t,n){let{showExpectedOutput:s}=t,{showCategory:o}=t,{showFeedback:i}=t,{showUpcomingQueue:a}=t,{enableAudioHints:r}=t,{translationThreshold:l}=t,{pauseBetweenTests:c}=t,{pauseWhenStruggling:u}=t;const g=L();return e.$$set=e=>{"showExpectedOutput"in e&&n(0,s=e.showExpectedOutput),"showCategory"in e&&n(1,o=e.showCategory),"showFeedback"in e&&n(2,i=e.showFeedback),"showUpcomingQueue"in e&&n(3,a=e.showUpcomingQueue),"enableAudioHints"in e&&n(4,r=e.enableAudioHints),"translationThreshold"in e&&n(5,l=e.translationThreshold),"pauseBetweenTests"in e&&n(6,c=e.pauseBetweenTests),"pauseWhenStruggling"in e&&n(7,u=e.pauseWhenStruggling)},[s,o,i,a,r,l,c,u,function(){g("updateQueue")},function(){o=this.checked,n(1,o)},function(){i=this.checked,n(2,i)},function(){a=this.checked,n(3,a)},function(){r=this.checked,n(4,r)},function(){s=$(this),n(0,s)},function(){l=y(this.value),n(5,l)},function(){c=y(this.value),n(6,c)},function(){u=y(this.value),n(7,u)}]}class fe extends J{constructor(e){super(),z(this,e,pe,de,i,{showExpectedOutput:0,showCategory:1,showFeedback:2,showUpcomingQueue:3,enableAudioHints:4,translationThreshold:5,pauseBetweenTests:6,pauseWhenStruggling:7})}}function me(e){let t,n,o,i,a,u,p,y,v,$,S,T,x,k,L,C,E,R,_=0===e[2]?"Silent - no console output":e[2]<=3?"Quiet - errors and warnings only":e[2]<=6?"Normal - important events":"Verbose - detailed debugging info";return{c(){t=g("div"),n=g("label"),o=h("üõ†Ô∏è Console Logging Verbosity: "),i=h(e[2]),a=d(),u=g("span"),p=h(_),y=d(),v=g("input"),$=d(),S=g("div"),S.innerHTML="<span>Silent (0)</span> \n        <span>Default (5)</span> \n        <span>Verbose (10)</span>",T=d(),x=g("div"),k=g("button"),k.textContent="‚úÖ Pass Next Test",L=d(),C=g("button"),C.textContent="‚ùå Fail Next Test",m(u,"class","threshold-description"),m(n,"class","form-label"),m(v,"type","range"),m(v,"min","0"),m(v,"max","10"),m(v,"step","1"),m(v,"class","threshold-slider"),m(S,"class","threshold-labels"),m(k,"class","debug-btn pass-btn"),m(C,"class","debug-btn fail-btn"),m(x,"class","debug-buttons"),m(t,"class","threshold-setting developer-setting")},m(s,c){l(s,t,c),r(t,n),r(n,o),r(n,i),r(n,a),r(n,u),r(u,p),r(t,y),r(t,v),w(v,e[2]),r(t,$),r(t,S),r(t,T),r(t,x),r(x,k),r(x,L),r(x,C),E||(R=[f(v,"change",e[7]),f(v,"input",e[7]),f(k,"click",e[8]),f(C,"click",e[9])],E=!0)},p(e,t){4&t&&b(i,e[2]),4&t&&_!==(_=0===e[2]?"Silent - no console output":e[2]<=3?"Quiet - errors and warnings only":e[2]<=6?"Normal - important events":"Verbose - detailed debugging info")&&b(p,_),4&t&&w(v,e[2])},d(e){e&&c(t),E=!1,s(R)}}}function ye(t){let n,o,i,a,u,p,y,v,$,S,T,x,k,L,C,E,R,_,A,P,F,D,O,q,N,I,Q,H,V,M,B,U,W,K=t[1]<=3?"Less repetitive - tests advance quickly":t[1]>=8?"Very repetitive - tests stay at front longer":"Balanced repetition",j=t[3]&&me(t);return{c(){n=g("div"),o=g("h3"),o.textContent="Learning Algorithm",i=d(),a=g("div"),u=g("label"),p=h("Pass Threshold: "),y=h(t[0]),v=d(),$=g("span"),S=h("Scores "),T=h(t[0]),x=h(" and above are considered a pass"),k=d(),L=g("input"),C=d(),E=g("div"),E.innerHTML="<span>Easy (1)</span> \n      <span>Default (7)</span> \n      <span>Hard (10)</span>",R=d(),_=g("style"),_.textContent="/* Component-specific styles for AlgorithmSettings */\n  .algorithm-settings {\n    margin-top: 1rem;\n  }\n  \n  .developer-setting {\n    border: 2px dashed #8b5cf6;\n    background: rgba(139, 92, 246, 0.05);\n    border-radius: 0.5rem;\n    padding: 1rem;\n    margin-top: 1rem;\n  }\n  \n  .debug-buttons {\n    display: flex;\n    gap: 0.5rem;\n    margin-top: 1rem;\n  }\n  \n  .debug-btn {\n    padding: 0.5rem 1rem;\n    border: none;\n    border-radius: 0.375rem;\n    font-size: 0.875rem;\n    font-weight: 500;\n    cursor: pointer;\n    transition: all 0.2s;\n    flex: 1;\n  }\n  \n  .pass-btn {\n    background: #10b981;\n    color: white;\n  }\n  \n  .pass-btn:hover {\n    background: #059669;\n  }\n  \n  .fail-btn {\n    background: #ef4444;\n    color: white;\n  }\n  \n  .fail-btn:hover {\n    background: #dc2626;\n  }",A=d(),P=g("div"),F=g("label"),D=h("Test Repetitiveness: "),O=h(t[1]),q=d(),N=g("span"),I=h(K),Q=d(),H=g("input"),V=d(),M=g("div"),M.innerHTML="<span>Less (1)</span> \n      <span>Default (5)</span> \n      <span>More (10)</span>",B=d(),j&&j.c(),m(o,"class","section-header"),m($,"class","threshold-description"),m(u,"class","form-label"),m(L,"type","range"),m(L,"min","1"),m(L,"max","10"),m(L,"step","1"),m(L,"class","threshold-slider"),m(E,"class","threshold-labels"),m(a,"class","threshold-setting"),m(N,"class","threshold-description"),m(F,"class","form-label"),m(H,"type","range"),m(H,"min","1"),m(H,"max","10"),m(H,"step","1"),m(H,"class","threshold-slider"),m(M,"class","threshold-labels"),m(P,"class","threshold-setting"),m(n,"class","algorithm-settings")},m(e,s){l(e,n,s),r(n,o),r(n,i),r(n,a),r(a,u),r(u,p),r(u,y),r(u,v),r(u,$),r($,S),r($,T),r($,x),r(a,k),r(a,L),w(L,t[0]),r(a,C),r(a,E),r(a,R),r(a,_),r(n,A),r(n,P),r(P,F),r(F,D),r(F,O),r(F,q),r(F,N),r(N,I),r(P,Q),r(P,H),w(H,t[1]),r(P,V),r(P,M),r(n,B),j&&j.m(n,null),U||(W=[f(L,"change",t[5]),f(L,"input",t[5]),f(H,"change",t[6]),f(H,"input",t[6])],U=!0)},p(e,[t]){1&t&&b(y,e[0]),1&t&&b(T,e[0]),1&t&&w(L,e[0]),2&t&&b(O,e[1]),2&t&&K!==(K=e[1]<=3?"Less repetitive - tests advance quickly":e[1]>=8?"Very repetitive - tests stay at front longer":"Balanced repetition")&&b(I,K),2&t&&w(H,e[1]),e[3]?j?j.p(e,t):(j=me(e),j.c(),j.m(n,null)):j&&(j.d(1),j=null)},i:e,o:e,d(e){e&&c(n),j&&j.d(),U=!1,s(W)}}}function be(e,t,n){let{passThreshold:s}=t,{repetitivenessFactor:o}=t,{showDeveloperSettings:i}=t,{loggingVerbosity:a}=t;const r=L();return e.$$set=e=>{"passThreshold"in e&&n(0,s=e.passThreshold),"repetitivenessFactor"in e&&n(1,o=e.repetitivenessFactor),"showDeveloperSettings"in e&&n(3,i=e.showDeveloperSettings),"loggingVerbosity"in e&&n(2,a=e.loggingVerbosity)},[s,o,a,i,r,function(){s=y(this.value),n(0,s)},function(){o=y(this.value),n(1,o)},function(){a=y(this.value),n(2,a)},()=>r("debugTest",{action:"pass"}),()=>r("debugTest",{action:"fail"})]}class we extends J{constructor(e){super(),z(this,e,be,ye,i,{passThreshold:0,repetitivenessFactor:1,showDeveloperSettings:3,loggingVerbosity:2})}}function ve(e,t,n){const s=e.slice();return s[7]=t[n],s}function $e(e){let t,n,s,o,i,a,h,p=!Object.values(e[1]).some(ke),f=e[0],y=[];for(let t=0;t<f.length;t+=1)y[t]=Se(ve(e,f,t));let b=p&&Te();return{c(){t=g("h3"),t.textContent="Learning Categories",n=d(),s=g("div"),o=g("div");for(let e=0;e<y.length;e+=1)y[e].c();i=d(),b&&b.c(),a=d(),h=g("style"),h.textContent="/* Component-specific styles for CategoryManager */\n  .categories-section {\n    margin-top: 1rem;\n  }\n  \n  .categories-list {\n    margin-top: 0.5rem;\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 0.5rem;\n  }\n  \n  @media (min-width: 640px) {\n    .categories-list {\n      grid-template-columns: 1fr 1fr;\n    }\n  }\n  \n  /* Fieldset styling for categories */\n  fieldset {\n    border: none;\n    padding: 0;\n    margin: 0;\n  }\n  \n  legend {\n    padding: 0;\n    margin-bottom: 0.5rem;\n  }",m(t,"class","section-header"),m(o,"class","categories-list"),m(s,"class","categories-section")},m(e,c){l(e,t,c),l(e,n,c),l(e,s,c),r(s,o);for(let e=0;e<y.length;e+=1)y[e]&&y[e].m(o,null);r(s,i),b&&b.m(s,null),r(s,a),r(s,h)},p(e,t){if(15&t){let n;for(f=e[0],n=0;n<f.length;n+=1){const s=ve(e,f,n);y[n]?y[n].p(s,t):(y[n]=Se(s),y[n].c(),y[n].m(o,null))}for(;n<y.length;n+=1)y[n].d(1);y.length=f.length}2&t&&(p=!Object.values(e[1]).some(ke)),p?b||(b=Te(),b.c(),b.m(s,a)):b&&(b.d(1),b=null)},d(e){e&&c(t),e&&c(n),e&&c(s),u(y,e),b&&b.d()}}}function Se(e){let t,n,s,o,i,a,u,p,y,w=e[7]+"";function v(...t){return e[5](e[7],...t)}return{c(){t=g("label"),n=g("input"),o=d(),i=g("span"),a=h(w),u=d(),m(n,"type","checkbox"),m(n,"class","category-checkbox"),n.checked=s=e[1][e[7]]||!1,m(i,"class","category-label"),m(t,"class","category-item")},m(e,s){l(e,t,s),r(t,n),r(t,o),r(t,i),r(i,a),r(t,u),p||(y=f(n,"change",v),p=!0)},p(t,o){e=t,3&o&&s!==(s=e[1][e[7]]||!1)&&(n.checked=s),1&o&&w!==(w=e[7]+"")&&b(a,w)},d(e){e&&c(t),p=!1,y()}}}function Te(e){let t;return{c(){t=g("div"),t.textContent="At least one category must be enabled to start learning!",m(t,"class","error-text")},m(e,n){l(e,t,n)},d(e){e&&c(t)}}}function xe(t){let n,s=t[0].length>0&&$e(t);return{c(){s&&s.c(),n=p()},m(e,t){s&&s.m(e,t),l(e,n,t)},p(e,[t]){e[0].length>0?s?s.p(e,t):(s=$e(e),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i:e,o:e,d(e){s&&s.d(e),e&&c(n)}}}const ke=e=>e;function Le(e,t,n){let{categories:s}=t,{enabledCategories:o}=t,{loggingVerbosity:i=5}=t;const a=L();function r(e,...t){i>=e&&console.log(...t)}function l(e,t){r(6,`üîò Category toggle: ${e} ‚Üí ${t}`),r(8,"üìã enabledCategories before update:",o);const n={...o,[e]:t};r(8,"üìã enabledCategories after update:",n),a("categoryChange",{category:e,enabled:t,newEnabledCategories:n})}return e.$$set=e=>{"categories"in e&&n(0,s=e.categories),"enabledCategories"in e&&n(1,o=e.enabledCategories),"loggingVerbosity"in e&&n(4,i=e.loggingVerbosity)},[s,o,r,l,i,(e,t)=>{r(6,`üñ±Ô∏è Checkbox clicked: ${e}, checked: ${t.target.checked}`),l(e,t.target.checked)}]}class Ce extends J{constructor(e){super(),z(this,e,Le,xe,i,{categories:0,enabledCategories:1,loggingVerbosity:4})}}function Ee(t){let n;return{c(){n=g("p"),n.textContent="Ready to start learning",m(n,"class","placeholder-text")},m(e,t){l(e,n,t)},p:e,d(e){e&&c(n)}}}function Re(e){let t,n,s,o,i,a,u,p=e[0].source+"",f=e[6](e[0]),y=e[4]&&_e(e),w=f&&Ae(e);return{c(){t=g("div"),y&&y.c(),n=d(),s=g("p"),s.textContent="Translate this:",o=d(),i=g("p"),a=h(p),u=d(),w&&w.c(),m(s,"class","phrase-label"),m(i,"class","phrase-text"),m(t,"class","phrase-content")},m(e,c){l(e,t,c),y&&y.m(t,null),r(t,n),r(t,s),r(t,o),r(t,i),r(i,a),r(t,u),w&&w.m(t,null)},p(e,s){e[4]?y?y.p(e,s):(y=_e(e),y.c(),y.m(t,n)):y&&(y.d(1),y=null),1&s&&p!==(p=e[0].source+"")&&b(a,p),1&s&&(f=e[6](e[0])),f?w?w.p(e,s):(w=Ae(e),w.c(),w.m(t,null)):w&&(w.d(1),w=null)},d(e){e&&c(t),y&&y.d(),w&&w.d()}}}function _e(e){let t,n,s,o=e[0].category+"";return{c(){t=g("p"),n=h("Category: "),s=h(o),m(t,"class","phrase-category")},m(e,o){l(e,t,o),r(t,n),r(t,s)},p(e,t){1&t&&o!==(o=e[0].category+"")&&b(s,o)},d(e){e&&c(t)}}}function Ae(e){let t,n,s,o=e[0].target+"";return{c(){t=g("p"),n=h("Expected: "),s=h(o),m(t,"class","expected-text")},m(e,o){l(e,t,o),r(t,n),r(t,s)},p(e,t){1&t&&o!==(o=e[0].target+"")&&b(s,o)},d(e){e&&c(t)}}}function Pe(t){let n;return{c(){n=g("p"),n.textContent="Ready to start learning!",m(n,"class","status-text")},m(e,t){l(e,n,t)},p:e,d(e){e&&c(n)}}}function Fe(t){let n;return{c(){n=g("p"),n.textContent="Listening...",m(n,"class","status-text")},m(e,t){l(e,n,t)},p:e,d(e){e&&c(n)}}}function De(t){let n;return{c(){n=g("p"),n.textContent="üéØ Here is a hint for you",m(n,"class","status-text")},m(e,t){l(e,n,t)},p:e,d(e){e&&c(n)}}}function Oe(e){let t,n;return{c(){t=g("p"),n=h(e[1]),m(t,"class","status-text")},m(e,s){l(e,t,s),r(t,n)},p(e,t){2&t&&b(n,e[1])},d(e){e&&c(t)}}}function qe(t){let n,s,o,i,a,u,p,y,w,v,$,S,T,x,k,L=t[2]?"‚èπÔ∏è":"‚ñ∂Ô∏è",C=t[2]?"Stop Learning":"Start Learning";function E(e,t){return e[0]?Re:Ee}let R=E(t),_=R(t);function A(e,t){return 1&t&&(i=null),e[5]?Oe:(null==i&&(i=!(!e[0]||!e[7](e[0]))),i?De:e[2]?Fe:Pe)}let P=A(t,-1),F=P(t);return{c(){n=g("div"),_.c(),s=d(),o=g("div"),F.c(),a=d(),u=g("div"),p=g("button"),y=g("span"),w=h(L),v=d(),$=h(C),m(n,"class","phrase-display"),m(o,"class","status-area"),m(y,"class","btn-icon"),m(p,"class",S="start-stop-btn "+(t[2]?"stop-btn":"start-btn")),p.disabled=T=!t[3]&&!t[2],m(u,"class","button-container")},m(e,i){l(e,n,i),_.m(n,null),l(e,s,i),l(e,o,i),F.m(o,null),l(e,a,i),l(e,u,i),r(u,p),r(p,y),r(y,w),r(p,v),r(p,$),x||(k=f(p,"click",t[8]),x=!0)},p(e,[t]){R===(R=E(e))&&_?_.p(e,t):(_.d(1),_=R(e),_&&(_.c(),_.m(n,null))),P===(P=A(e,t))&&F?F.p(e,t):(F.d(1),F=P(e),F&&(F.c(),F.m(o,null))),4&t&&L!==(L=e[2]?"‚èπÔ∏è":"‚ñ∂Ô∏è")&&b(w,L),4&t&&C!==(C=e[2]?"Stop Learning":"Start Learning")&&b($,C),4&t&&S!==(S="start-stop-btn "+(e[2]?"stop-btn":"start-btn"))&&m(p,"class",S),12&t&&T!==(T=!e[3]&&!e[2])&&(p.disabled=T)},i:e,o:e,d(e){e&&c(n),_.d(),e&&c(s),e&&c(o),F.d(),e&&c(a),e&&c(u),x=!1,k()}}}function Ne(e,t,n){let{currentPhrase:s}=t,{status:o}=t,{isLearning:i}=t,{canStart:a}=t,{showCategory:r}=t,{showFeedback:l}=t,{showExpectedOutput:c}=t,{enableAudioHints:u}=t,{nativeLanguage:g}=t,{learningLanguage:h}=t;const d=L();return e.$$set=e=>{"currentPhrase"in e&&n(0,s=e.currentPhrase),"status"in e&&n(1,o=e.status),"isLearning"in e&&n(2,i=e.isLearning),"canStart"in e&&n(3,a=e.canStart),"showCategory"in e&&n(4,r=e.showCategory),"showFeedback"in e&&n(5,l=e.showFeedback),"showExpectedOutput"in e&&n(9,c=e.showExpectedOutput),"enableAudioHints"in e&&n(10,u=e.enableAudioHints),"nativeLanguage"in e&&n(11,g=e.nativeLanguage),"learningLanguage"in e&&n(12,h=e.learningLanguage)},[s,o,i,a,r,l,function(e){if("always"===c)return!0;if("never"===c)return!1;if("struggling"===c){if(!e.recentResults||0===e.recentResults.length)return!0;return e.recentResults.filter(e=>1===e).length/e.recentResults.length<.25}return!0},function(e){if(!u||!e.recentResults||0===e.recentResults.length)return!1;const t=e.recentResults.filter(e=>1===e).length,n=t/e.recentResults.length;return t>0&&n<.5},function(){d("startStop")},c,u,g,h]}class Ie extends J{constructor(e){super(),z(this,e,Ne,qe,i,{currentPhrase:0,status:1,isLearning:2,canStart:3,showCategory:4,showFeedback:5,showExpectedOutput:9,enableAudioHints:10,nativeLanguage:11,learningLanguage:12})}}function Qe(e,t,n){const s=e.slice();return s[2]=t[n],s}function He(e){let t,n,s,o,i,a,p,f=e[1].length+"",y=e[1],w=[];for(let t=0;t<y.length;t+=1)w[t]=Ve(Qe(e,y,t));return{c(){t=g("div"),n=g("h3"),s=h("Complete Learning Queue ("),o=h(f),i=h(" items)"),a=d(),p=g("div");for(let e=0;e<w.length;e+=1)w[e].c();m(n,"class","queue-title"),m(p,"class","queue-list"),m(t,"class","queue-section")},m(e,c){l(e,t,c),r(t,n),r(n,s),r(n,o),r(n,i),r(t,a),r(t,p);for(let e=0;e<w.length;e+=1)w[e]&&w[e].m(p,null)},p(e,t){if(2&t&&f!==(f=e[1].length+"")&&b(o,f),2&t){let n;for(y=e[1],n=0;n<y.length;n+=1){const s=Qe(e,y,n);w[n]?w[n].p(s,t):(w[n]=Ve(s),w[n].c(),w[n].m(p,null))}for(;n<w.length;n+=1)w[n].d(1);w.length=y.length}},d(e){e&&c(t),u(w,e)}}}function Ve(e){let t,n,s,o,i,a,u,p,f,y,w,v,$,T,x,k,L,C,E,R=e[2].position+"",_=e[2].source+"",A=e[2].category+"",P=0===e[2].recentResults.length?"New":`${(100*e[2].successRate).toFixed(0)}%`,F=e[2].recentResults.filter(Be).length+"",D=e[2].recentResults.length+"";return{c(){t=g("div"),n=g("span"),s=h("#"),o=h(R),i=d(),a=g("span"),u=h(_),p=d(),f=g("span"),y=h(A),w=d(),v=g("span"),$=h(P),T=d(),x=g("span"),k=h(F),L=h("/"),C=h(D),E=d(),m(n,"class","queue-position"),m(a,"class","queue-text"),m(f,"class","queue-category"),m(v,"class","queue-success-rate"),S(v,"struggling",e[2].successRate<.3),S(v,"mastered",e[2].successRate>.7),m(x,"class","queue-success-count"),m(t,"class","queue-item"),S(t,"current",1===e[2].position)},m(e,c){l(e,t,c),r(t,n),r(n,s),r(n,o),r(t,i),r(t,a),r(a,u),r(t,p),r(t,f),r(f,y),r(t,w),r(t,v),r(v,$),r(t,T),r(t,x),r(x,k),r(x,L),r(x,C),r(t,E)},p(e,n){2&n&&R!==(R=e[2].position+"")&&b(o,R),2&n&&_!==(_=e[2].source+"")&&b(u,_),2&n&&A!==(A=e[2].category+"")&&b(y,A),2&n&&P!==(P=0===e[2].recentResults.length?"New":`${(100*e[2].successRate).toFixed(0)}%`)&&b($,P),2&n&&S(v,"struggling",e[2].successRate<.3),2&n&&S(v,"mastered",e[2].successRate>.7),2&n&&F!==(F=e[2].recentResults.filter(Be).length+"")&&b(k,F),2&n&&D!==(D=e[2].recentResults.length+"")&&b(C,D),2&n&&S(t,"current",1===e[2].position)},d(e){e&&c(t)}}}function Me(t){let n,s=t[0]&&t[1].length>0&&He(t);return{c(){s&&s.c(),n=p()},m(e,t){s&&s.m(e,t),l(e,n,t)},p(e,[t]){e[0]&&e[1].length>0?s?s.p(e,t):(s=He(e),s.c(),s.m(n.parentNode,n)):s&&(s.d(1),s=null)},i:e,o:e,d(e){s&&s.d(e),e&&c(n)}}}const Be=e=>e;function Ue(e,t,n){let{showUpcomingQueue:s}=t,{upcomingQueue:o}=t;return e.$$set=e=>{"showUpcomingQueue"in e&&n(0,s=e.showUpcomingQueue),"upcomingQueue"in e&&n(1,o=e.upcomingQueue)},[s,o]}class We extends J{constructor(e){super(),z(this,e,Ue,Me,i,{showUpcomingQueue:0,upcomingQueue:1})}}function Ke(e){let t,n,o,i,a,u,p,y,b,w,v,$,S,T,x,k,L,C,R,_,A,P,F,O,q,N,I,Q,H,j,z,J,G,Y;function Z(t){e[22](t)}function X(t){e[23](t)}function ee(t){e[24](t)}function te(t){e[25](t)}function ne(t){e[26](t)}function se(t){e[27](t)}function oe(t){e[28](t)}function ie(t){e[29](t)}n=new le({props:{nativeLanguage:e[1].nativeLanguage,learningLanguage:e[1].learningLanguage,nativeLanguages:e[11],learningLanguages:e[10],loggingVerbosity:e[1].loggingVerbosity}});let ae={};function re(t){e[30](t)}function ce(t){e[31](t)}function ue(t){e[32](t)}void 0!==e[1].showExpectedOutput&&(ae.showExpectedOutput=e[1].showExpectedOutput),void 0!==e[1].showCategory&&(ae.showCategory=e[1].showCategory),void 0!==e[1].showFeedback&&(ae.showFeedback=e[1].showFeedback),void 0!==e[1].showUpcomingQueue&&(ae.showUpcomingQueue=e[1].showUpcomingQueue),void 0!==e[1].enableAudioHints&&(ae.enableAudioHints=e[1].enableAudioHints),void 0!==e[1].translationThreshold&&(ae.translationThreshold=e[1].translationThreshold),void 0!==e[1].pauseBetweenTests&&(ae.pauseBetweenTests=e[1].pauseBetweenTests),void 0!==e[1].pauseWhenStruggling&&(ae.pauseWhenStruggling=e[1].pauseWhenStruggling),i=new fe({props:ae}),E.push(()=>B(i,"showExpectedOutput",Z)),E.push(()=>B(i,"showCategory",X)),E.push(()=>B(i,"showFeedback",ee)),E.push(()=>B(i,"showUpcomingQueue",te)),E.push(()=>B(i,"enableAudioHints",ne)),E.push(()=>B(i,"translationThreshold",se)),E.push(()=>B(i,"pauseBetweenTests",oe)),E.push(()=>B(i,"pauseWhenStruggling",ie)),i.$on("updateQueue",e[14]);let ge={showDeveloperSettings:e[1].showDeveloperSettings};return void 0!==e[1].passThreshold&&(ge.passThreshold=e[1].passThreshold),void 0!==e[1].repetitivenessFactor&&(ge.repetitivenessFactor=e[1].repetitivenessFactor),void 0!==e[1].loggingVerbosity&&(ge.loggingVerbosity=e[1].loggingVerbosity),T=new we({props:ge}),E.push(()=>B(T,"passThreshold",re)),E.push(()=>B(T,"repetitivenessFactor",ce)),E.push(()=>B(T,"loggingVerbosity",ue)),T.$on("debugTest",e[13]),R=new Ce({props:{categories:e[0],enabledCategories:e[1].enabledCategories,loggingVerbosity:e[1].loggingVerbosity}}),R.$on("categoryChange",e[12]),{c(){t=g("div"),U(n.$$.fragment),o=d(),U(i.$$.fragment),S=d(),U(T.$$.fragment),C=d(),U(R.$$.fragment),_=d(),A=g("div"),P=g("h3"),P.textContent="Management",F=d(),O=g("div"),q=g("button"),N=h("üóëÔ∏è Clear TTS Cache"),Q=d(),H=g("button"),j=h("üîÑ Reset Learning Queue"),m(P,"class","section-header"),m(q,"class","management-btn clear-btn"),q.disabled=I=!e[7],m(H,"class","management-btn reset-btn"),H.disabled=z=!e[6],m(O,"class","management-buttons"),m(A,"class","management-section"),m(t,"class","settings-panel")},m(s,a){l(s,t,a),W(n,t,null),r(t,o),W(i,t,null),r(t,S),W(T,t,null),r(t,C),W(R,t,null),r(t,_),r(t,A),r(A,P),r(A,F),r(A,O),r(O,q),r(q,N),r(O,Q),r(O,H),r(H,j),J=!0,G||(Y=[f(q,"click",e[20]),f(H,"click",e[21])],G=!0)},p(e,t){const s={};2&t[0]&&(s.nativeLanguage=e[1].nativeLanguage),2&t[0]&&(s.learningLanguage=e[1].learningLanguage),1024&t[0]&&(s.learningLanguages=e[10]),2&t[0]&&(s.loggingVerbosity=e[1].loggingVerbosity),n.$set(s);const o={};!a&&2&t[0]&&(a=!0,o.showExpectedOutput=e[1].showExpectedOutput,D(()=>a=!1)),!u&&2&t[0]&&(u=!0,o.showCategory=e[1].showCategory,D(()=>u=!1)),!p&&2&t[0]&&(p=!0,o.showFeedback=e[1].showFeedback,D(()=>p=!1)),!y&&2&t[0]&&(y=!0,o.showUpcomingQueue=e[1].showUpcomingQueue,D(()=>y=!1)),!b&&2&t[0]&&(b=!0,o.enableAudioHints=e[1].enableAudioHints,D(()=>b=!1)),!w&&2&t[0]&&(w=!0,o.translationThreshold=e[1].translationThreshold,D(()=>w=!1)),!v&&2&t[0]&&(v=!0,o.pauseBetweenTests=e[1].pauseBetweenTests,D(()=>v=!1)),!$&&2&t[0]&&($=!0,o.pauseWhenStruggling=e[1].pauseWhenStruggling,D(()=>$=!1)),i.$set(o);const r={};2&t[0]&&(r.showDeveloperSettings=e[1].showDeveloperSettings),!x&&2&t[0]&&(x=!0,r.passThreshold=e[1].passThreshold,D(()=>x=!1)),!k&&2&t[0]&&(k=!0,r.repetitivenessFactor=e[1].repetitivenessFactor,D(()=>k=!1)),!L&&2&t[0]&&(L=!0,r.loggingVerbosity=e[1].loggingVerbosity,D(()=>L=!1)),T.$set(r);const l={};1&t[0]&&(l.categories=e[0]),2&t[0]&&(l.enabledCategories=e[1].enabledCategories),2&t[0]&&(l.loggingVerbosity=e[1].loggingVerbosity),R.$set(l),(!J||128&t[0]&&I!==(I=!e[7]))&&(q.disabled=I),(!J||64&t[0]&&z!==(z=!e[6]))&&(H.disabled=z)},i(e){J||(V(n.$$.fragment,e),V(i.$$.fragment,e),V(T.$$.fragment,e),V(R.$$.fragment,e),J=!0)},o(e){M(n.$$.fragment,e),M(i.$$.fragment,e),M(T.$$.fragment,e),M(R.$$.fragment,e),J=!1},d(e){e&&c(t),K(n),K(i),K(T),K(R),G=!1,s(Y)}}}function je(e){let t,n,o,i,a,u,p,y,w,v,$,T,x,k,L,C,E,R,_=e[2]?"‚¨ÜÔ∏è":"‚¨áÔ∏è";i=new Ie({props:{currentPhrase:e[4],status:e[5],isLearning:e[3],canStart:e[9],showCategory:e[1].showCategory,showFeedback:e[1].showFeedback,showExpectedOutput:e[1].showExpectedOutput,enableAudioHints:e[1].enableAudioHints,nativeLanguage:e[1].nativeLanguage,learningLanguage:e[1].learningLanguage}}),i.$on("startStop",e[15]);let A=e[2]&&Ke(e);return L=new We({props:{showUpcomingQueue:e[1].showUpcomingQueue,upcomingQueue:e[8]}}),{c(){t=g("main"),n=g("div"),n.innerHTML="<h1>Language Tutor</h1> \n    <p>Your personal AI language learning companion</p>",o=d(),U(i.$$.fragment),a=d(),u=g("div"),p=g("button"),y=g("span"),y.textContent="‚öôÔ∏è",w=h("\n      Settings\n      "),v=g("span"),$=h(_),x=d(),A&&A.c(),k=d(),U(L.$$.fragment),m(n,"class","title"),m(y,"class","settings-icon svelte-15o4qf2"),S(y,"developer-mode",e[1].showDeveloperSettings),m(v,"class","chevron-icon"),m(p,"class","settings-toggle"),m(p,"title",T=e[1].showDeveloperSettings?"Developer mode active! Long press again to disable.":"Long press for developer settings"),m(u,"class","settings-section"),m(t,"class","app-container")},m(s,c){l(s,t,c),r(t,n),r(t,o),W(i,t,null),r(t,a),r(t,u),r(u,p),r(p,y),r(p,w),r(p,v),r(v,$),r(u,x),A&&A.m(u,null),r(t,k),W(L,t,null),C=!0,E||(R=[f(p,"click",e[16]),f(p,"mousedown",e[17]),f(p,"mouseup",e[18]),f(p,"mouseleave",e[19]),f(p,"touchstart",e[17],{passive:!0}),f(p,"touchend",e[18],{passive:!0})],E=!0)},p(e,t){const n={};16&t[0]&&(n.currentPhrase=e[4]),32&t[0]&&(n.status=e[5]),8&t[0]&&(n.isLearning=e[3]),512&t[0]&&(n.canStart=e[9]),2&t[0]&&(n.showCategory=e[1].showCategory),2&t[0]&&(n.showFeedback=e[1].showFeedback),2&t[0]&&(n.showExpectedOutput=e[1].showExpectedOutput),2&t[0]&&(n.enableAudioHints=e[1].enableAudioHints),2&t[0]&&(n.nativeLanguage=e[1].nativeLanguage),2&t[0]&&(n.learningLanguage=e[1].learningLanguage),i.$set(n),(!C||2&t[0])&&S(y,"developer-mode",e[1].showDeveloperSettings),(!C||4&t[0])&&_!==(_=e[2]?"‚¨ÜÔ∏è":"‚¨áÔ∏è")&&b($,_),(!C||2&t[0]&&T!==(T=e[1].showDeveloperSettings?"Developer mode active! Long press again to disable.":"Long press for developer settings"))&&m(p,"title",T),e[2]?A?(A.p(e,t),4&t[0]&&V(A,1)):(A=Ke(e),A.c(),V(A,1),A.m(u,null)):A&&(H={r:0,c:[],p:H},M(A,1,1,()=>{A=null}),H.r||s(H.c),H=H.p);const o={};2&t[0]&&(o.showUpcomingQueue=e[1].showUpcomingQueue),256&t[0]&&(o.upcomingQueue=e[8]),L.$set(o)},i(e){C||(V(i.$$.fragment,e),V(A),V(L.$$.fragment,e),C=!0)},o(e){M(i.$$.fragment,e),M(A),M(L.$$.fragment,e),C=!1},d(e){e&&c(t),K(i),A&&A.d(),K(L),E=!1,s(R)}}}function ze(e,t,n){let s,o,i=!1,a=!1,r=null,l="Ready to start learning!",c=null,u=null,g=[],h=[],d=!1,p={};ee.subscribe(e=>{n(1,p=e),d&&async function(){(c||u)&&(await w(),v())}()});const f={English:["Italian","Spanish"]},m=Object.keys(f);function y(e,...t){p.loggingVerbosity>=e&&console.log(...t)}var b;async function w(){y(5,"üèóÔ∏è Initializing LearningQueue for:",p.nativeLanguage,"‚Üí",p.learningLanguage),n(0,g=[]),n(6,c=new G(p.nativeLanguage,p.learningLanguage,"basic","learning/",{passThreshold:p.passThreshold,memoryLength:20,repetitivenessFactor:p.repetitivenessFactor})),await c.init();const e=c.getCategories();n(0,g=e);const t={};e.forEach(e=>{t[e]=p.enabledCategories[e]??!0,c.setCategory(e,t[e])}),ee.updateSetting("enabledCategories",t),$(),y(5,"‚úÖ LearningQueue initialization complete")}function v(){n(7,u=new Y(null,p.nativeLanguage,p.learningLanguage,{apiKeyEndpoint:"openai.php",feedbackThreshold:p.translationThreshold,loggingVerbosity:p.loggingVerbosity,audioPath:"audio/",enableAudioHints:p.enableAudioHints,statusCallback:e=>{!p.showFeedback&&a?e.includes("Listen to this")?n(5,l=`Listen to the ${p.nativeLanguage} phrase...`):e.includes("Now say it in")&&n(5,l=`Now say it in ${p.learningLanguage}...`):n(5,l=e)}}))}function $(){c&&p.showUpcomingQueue&&(n(8,h=c.getTopQueueItems()),y(7,"üìã Updated upcoming queue:",h.length,"items"))}async function S(){c&&u?(n(3,a=!0),n(5,l="Right then, let's get cracking!"),await async function(){for(;a;){const e=c.getNextTest();if(!e){n(5,l="No more phrases available! Check your category settings."),x();break}if(y(8,"üìã Got phrase from queue:",e),y(8,"üìä Phrase recentResults:",e.recentResults,"length:",e.recentResults?.length),n(4,r=e),n(5,l=`Ready to listen to ${p.nativeLanguage} phrase...`),!a)break;try{const t=await u.test(e.source,e.target,e.recentResults||[]);if(t.stop||!a){x();break}if(0===t.score)n(5,l=`No response detected - ${t.commentary}`),y(6,`‚è≥ Pausing ${p.pauseBetweenTests} seconds before repeating phrase`),await new Promise(e=>setTimeout(e,1e3*p.pauseBetweenTests));else{c.scoreCurrentTest(t.score),$(),n(5,l=`Score: ${t.score}/10 - ${t.commentary}`);const s=T(e,t.score);y(6,`‚è≥ Pausing ${s} seconds before next phrase`),await new Promise(e=>setTimeout(e,1e3*s))}}catch(e){n(5,l="Smeg! Something went wrong with the AI. Try again."),x();break}}}()):n(5,l="Blimey! Something's gone wrong with the initialisation.")}function T(e,t){if(!e||!e.recentResults||0===e.recentResults.length)return p.pauseBetweenTests;return e.recentResults.filter(e=>1===e).length/e.recentResults.length<.25||t<4?p.pauseWhenStruggling:p.pauseBetweenTests}function x(){n(3,a=!1),l.includes("Score:")||l.includes("commentary")||n(5,l="Learning session stopped. Ready when you are!"),n(4,r=null)}b=async()=>{y(4,"üöÄ App mounted, loading settings..."),ee.load(),await new Promise(e=>setTimeout(e,0)),await async function(){await w(),v()}(),d=!0,y(4,"üéâ App initialization complete")},k().$$.on_mount.push(b);let L=null;return e.$$.update=()=>{2&e.$$.dirty[0]&&n(10,s=f[p.nativeLanguage]||[]),3&e.$$.dirty[0]&&n(9,o=Object.values(p.enabledCategories).some(e=>e)&&g.length>0)},[g,p,i,a,r,l,c,u,h,o,s,m,function(e){const{category:t,enabled:n,newEnabledCategories:s}=e.detail;ee.updateSetting("enabledCategories",s),c&&(c.setCategory(t,n),$())},function(e){const{action:t}=e.detail;if(!c)return void y(3,"‚ùå Debug test failed: no learning queue");const s=c.getNextTest();if(!s)return void y(3,"‚ùå Debug test failed: no phrases available");const o="pass"===t?10:0;y(5,`üêõ Debug ${t}: "${s.source}" ‚Üí "${s.target}" (score: ${o})`),c.scoreCurrentTest(o),$(),n(5,l=`Debug ${t}: "${s.source}" scored ${o}/10`)},$,function(){a?x():S()},function(){n(2,i=!i)},function(){L=setTimeout(()=>{ee.updateSetting("showDeveloperSettings",!p.showDeveloperSettings),y(3,"ü•ö Developer settings easter egg triggered!",p.showDeveloperSettings?"Enabled":"Disabled");const e=document.querySelector(".settings-toggle");e&&(e.style.transform="scale(0.95)",setTimeout(()=>e.style.transform="",150))},2e3)},function(){L&&(clearTimeout(L),L=null)},function(){L&&(clearTimeout(L),L=null)},function(){if(u&&confirm("Are you sure you want to clear the TTS cache? This will remove all cached audio.")){const e=u.clearTTSCache();n(5,l=e?"TTS cache cleared successfully!":"Failed to clear TTS cache."),setTimeout(()=>{a||n(5,l="Ready to start learning!")},3e3)}},function(){if(c&&confirm("Are you sure you want to reset the learning queue? This will clear all progress and start fresh.")){c.reset();const e=c.getCategories();n(0,g=e);const t={};e.forEach(e=>{t[e]=!0,c.setCategory(e,!0)}),ee.updateSetting("enabledCategories",t),$(),n(5,l="Learning queue reset successfully!"),setTimeout(()=>{a||n(5,l="Ready to start learning!")},3e3)}},function(t){e.$$.not_equal(p.showExpectedOutput,t)&&(p.showExpectedOutput=t,n(1,p))},function(t){e.$$.not_equal(p.showCategory,t)&&(p.showCategory=t,n(1,p))},function(t){e.$$.not_equal(p.showFeedback,t)&&(p.showFeedback=t,n(1,p))},function(t){e.$$.not_equal(p.showUpcomingQueue,t)&&(p.showUpcomingQueue=t,n(1,p))},function(t){e.$$.not_equal(p.enableAudioHints,t)&&(p.enableAudioHints=t,n(1,p))},function(t){e.$$.not_equal(p.translationThreshold,t)&&(p.translationThreshold=t,n(1,p))},function(t){e.$$.not_equal(p.pauseBetweenTests,t)&&(p.pauseBetweenTests=t,n(1,p))},function(t){e.$$.not_equal(p.pauseWhenStruggling,t)&&(p.pauseWhenStruggling=t,n(1,p))},function(t){e.$$.not_equal(p.passThreshold,t)&&(p.passThreshold=t,n(1,p))},function(t){e.$$.not_equal(p.repetitivenessFactor,t)&&(p.repetitivenessFactor=t,n(1,p))},function(t){e.$$.not_equal(p.loggingVerbosity,t)&&(p.loggingVerbosity=t,n(1,p))}]}return new class extends J{constructor(e){super(),z(this,e,ze,je,i,{},null,[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
